"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = BottomWidgetFactory;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireWildcard(require("styled-components"));

var _constants = require("@kepler.gl/constants");

var _utils = require("@kepler.gl/utils");

var _styles = require("@kepler.gl/styles");

var _timeWidget = _interopRequireDefault(require("./filters/time-widget"));

var _filterAnimationController = _interopRequireDefault(require("./filter-animation-controller"));

var _layerAnimationController = _interopRequireDefault(require("./layer-animation-controller"));

var _animationControl = _interopRequireDefault(require("./common/animation-control/animation-control"));

var _templateObject, _templateObject2, _templateObject3;

var maxWidth = 1080;

var BottomWidgetContainer = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  padding-top: ", "px;\n  padding-right: ", "px;\n  padding-bottom: ", "px;\n  padding-left: ", "px;\n  pointer-events: none !important; /* prevent padding from blocking input */\n  & > * {\n    /* all children should allow input */\n    pointer-events: all;\n  }\n  width: ", "px;\n  z-index: 1;\n  ", "\n"])), function (props) {
  return props.hasPadding ? props.theme.bottomWidgetPaddingTop : 0;
}, function (props) {
  return props.hasPadding ? props.theme.bottomWidgetPaddingRight : 0;
}, function (props) {
  return props.hasPadding ? props.theme.bottomWidgetPaddingBottom : 0;
}, function (props) {
  return props.hasPadding ? props.theme.bottomWidgetPaddingLeft : 0;
}, function (props) {
  return props.width;
}, _styles.media.portable(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["padding: 0;"]))));

BottomWidgetFactory.deps = [_timeWidget["default"], _animationControl["default"], _filterAnimationController["default"], _layerAnimationController["default"]];
/* eslint-disable complexity */

function BottomWidgetFactory(TimeWidget, AnimationControl, FilterAnimationController, LayerAnimationController) {
  var LayerAnimationControl = (0, _styledComponents["default"])(AnimationControl)(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n    background-color: ", ";\n  "])), function (props) {
    return props.theme.sidePanelBg;
  });

  var BottomWidget = function BottomWidget(props) {
    var _uiState$mapControls, _uiState$mapControls$, _uiState$mapControls2, _uiState$mapControls3, _theme$mapControl, _theme$mapControl2, _theme$mapControl2$ma, _theme$mapControl2$ma2;

    var datasets = props.datasets,
        filters = props.filters,
        animationConfig = props.animationConfig,
        visStateActions = props.visStateActions,
        containerW = props.containerW,
        uiState = props.uiState,
        sidePanelWidth = props.sidePanelWidth,
        layers = props.layers,
        rootRef = props.rootRef,
        theme = props.theme;
    var activeSidePanel = uiState.activeSidePanel,
        readOnly = uiState.readOnly;
    var isOpen = Boolean(activeSidePanel);
    var enlargedFilterIdx = (0, _react.useMemo)(function () {
      return filters.findIndex(function (f) {
        return !(0, _utils.isSideFilter)(f);
      });
    }, [filters]);
    var isMobile = (0, _utils.hasPortableWidth)(_styles.breakPointValues);
    var animatedFilterIdx = (0, _react.useMemo)(function () {
      return filters.findIndex(function (f) {
        return f.isAnimating;
      });
    }, [filters]);
    var animatedFilter = animatedFilterIdx > -1 ? filters[animatedFilterIdx] : null;
    var isLegendPinned = ((_uiState$mapControls = uiState.mapControls) === null || _uiState$mapControls === void 0 ? void 0 : (_uiState$mapControls$ = _uiState$mapControls.mapLegend) === null || _uiState$mapControls$ === void 0 ? void 0 : _uiState$mapControls$.show) && ((_uiState$mapControls2 = uiState.mapControls) === null || _uiState$mapControls2 === void 0 ? void 0 : (_uiState$mapControls3 = _uiState$mapControls2.mapLegend) === null || _uiState$mapControls3 === void 0 ? void 0 : _uiState$mapControls3.active);
    var spaceForLegendWidth = isLegendPinned ? ((_theme$mapControl = theme.mapControl) === null || _theme$mapControl === void 0 ? void 0 : _theme$mapControl.width) + ((_theme$mapControl2 = theme.mapControl) === null || _theme$mapControl2 === void 0 ? void 0 : (_theme$mapControl2$ma = _theme$mapControl2.mapLegend) === null || _theme$mapControl2$ma === void 0 ? void 0 : (_theme$mapControl2$ma2 = _theme$mapControl2$ma.pinned) === null || _theme$mapControl2$ma2 === void 0 ? void 0 : _theme$mapControl2$ma2.right) * 2 - theme.bottomWidgetPaddingRight : 0;
    var enlargedFilterWidth = (isOpen && !isMobile ? containerW - sidePanelWidth : containerW) - spaceForLegendWidth; // show playback control if layers contain trip layer & at least one trip layer is visible

    var animatableLayer = (0, _react.useMemo)(function () {
      return layers.filter(function (l) {
        return l.config.animation && l.config.animation.enabled && l.config.isVisible;
      });
    }, [layers]);
    var readyToAnimation = Array.isArray(animationConfig.domain) && Number.isFinite(animationConfig.currentTime); // if animation control is showing, hide time display in time slider

    var showFloatingTimeDisplay = !animatableLayer.length;
    var showAnimationControl = animatableLayer.length && readyToAnimation && !animationConfig.hideControl;
    var showTimeWidget = enlargedFilterIdx > -1 && Object.keys(datasets).length > 0; // if filter is not animating, pass in enlarged filter here because
    // animation controller needs to call reset on it

    var filter = animatedFilter || filters[enlargedFilterIdx];
    var onClose = (0, _react.useCallback)(function () {
      return visStateActions.setFilterView(enlargedFilterIdx, _constants.FILTER_VIEW_TYPES.side);
    }, [visStateActions, enlargedFilterIdx]);
    return /*#__PURE__*/_react["default"].createElement(BottomWidgetContainer, {
      width: Math.min(maxWidth, enlargedFilterWidth),
      style: {
        marginRight: spaceForLegendWidth
      },
      className: "bottom-widget--container",
      hasPadding: showAnimationControl || showTimeWidget,
      ref: rootRef
    }, /*#__PURE__*/_react["default"].createElement(LayerAnimationController, {
      animationConfig: animationConfig,
      setLayerAnimationTime: visStateActions.setLayerAnimationTime
    }, function (isAnimating, start, pause, resetAnimation, timeline, setTimelineValue) {
      return showAnimationControl ? /*#__PURE__*/_react["default"].createElement(LayerAnimationControl, {
        updateAnimationSpeed: visStateActions.updateLayerAnimationSpeed,
        toggleAnimation: visStateActions.toggleLayerAnimation,
        isAnimatable: !animatedFilter,
        isAnimating: isAnimating,
        resetAnimation: resetAnimation,
        setTimelineValue: setTimelineValue,
        timeline: timeline
      }) : null;
    }), filter ? /*#__PURE__*/_react["default"].createElement(FilterAnimationController, {
      filter: filter,
      filterIdx: animatedFilterIdx > -1 ? animatedFilterIdx : enlargedFilterIdx,
      setFilterAnimationTime: visStateActions.setFilterAnimationTime
    }, function (isAnimating, start, pause, resetAnimation, timeline, setTimelineValue) {
      return showTimeWidget ? /*#__PURE__*/_react["default"].createElement(TimeWidget // TimeWidget uses React.memo, here we pass width
      // even though it doesnt use it, to force rerender
      , {
        filter: filters[enlargedFilterIdx],
        index: enlargedFilterIdx,
        datasets: datasets,
        readOnly: readOnly,
        showTimeDisplay: showFloatingTimeDisplay,
        setFilterPlot: visStateActions.setFilterPlot,
        setFilterAnimationTime: setTimelineValue,
        setFilterAnimationWindow: visStateActions.setFilterAnimationWindow,
        toggleAnimation: visStateActions.toggleFilterAnimation,
        updateAnimationSpeed: visStateActions.updateFilterAnimationSpeed,
        resetAnimation: resetAnimation,
        isAnimatable: !animationConfig || !animationConfig.isAnimating,
        onClose: onClose,
        timeline: timeline
      }) : null;
    }) : null);
  };
  /* eslint-disable react/display-name */


  return (0, _styledComponents.withTheme)(
  /*#__PURE__*/
  // @ts-ignore
  (0, _react.forwardRef)(function (props, ref) {
    return /*#__PURE__*/_react["default"].createElement(BottomWidget, (0, _extends2["default"])({}, props, {
      rootRef: ref
    }));
  }));
  /* eslint-enable react/display-name */
}
/* eslint-enable complexity */
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL3NyYy9ib3R0b20td2lkZ2V0LnRzeCJdLCJuYW1lcyI6WyJtYXhXaWR0aCIsIkJvdHRvbVdpZGdldENvbnRhaW5lciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwiaGFzUGFkZGluZyIsInRoZW1lIiwiYm90dG9tV2lkZ2V0UGFkZGluZ1RvcCIsImJvdHRvbVdpZGdldFBhZGRpbmdSaWdodCIsImJvdHRvbVdpZGdldFBhZGRpbmdCb3R0b20iLCJib3R0b21XaWRnZXRQYWRkaW5nTGVmdCIsIndpZHRoIiwibWVkaWEiLCJwb3J0YWJsZSIsIkJvdHRvbVdpZGdldEZhY3RvcnkiLCJkZXBzIiwiVGltZVdpZGdldEZhY3RvcnkiLCJBbmltYXRpb25Db250cm9sRmFjdG9yeSIsIkZpbHRlckFuaW1hdGlvbkNvbnRyb2xsZXJGYWN0b3J5IiwiTGF5ZXJBbmltYXRpb25Db250cm9sbGVyRmFjdG9yeSIsIlRpbWVXaWRnZXQiLCJBbmltYXRpb25Db250cm9sIiwiRmlsdGVyQW5pbWF0aW9uQ29udHJvbGxlciIsIkxheWVyQW5pbWF0aW9uQ29udHJvbGxlciIsIkxheWVyQW5pbWF0aW9uQ29udHJvbCIsInNpZGVQYW5lbEJnIiwiQm90dG9tV2lkZ2V0IiwiZGF0YXNldHMiLCJmaWx0ZXJzIiwiYW5pbWF0aW9uQ29uZmlnIiwidmlzU3RhdGVBY3Rpb25zIiwiY29udGFpbmVyVyIsInVpU3RhdGUiLCJzaWRlUGFuZWxXaWR0aCIsImxheWVycyIsInJvb3RSZWYiLCJhY3RpdmVTaWRlUGFuZWwiLCJyZWFkT25seSIsImlzT3BlbiIsIkJvb2xlYW4iLCJlbmxhcmdlZEZpbHRlcklkeCIsImZpbmRJbmRleCIsImYiLCJpc01vYmlsZSIsImJyZWFrUG9pbnRWYWx1ZXMiLCJhbmltYXRlZEZpbHRlcklkeCIsImlzQW5pbWF0aW5nIiwiYW5pbWF0ZWRGaWx0ZXIiLCJpc0xlZ2VuZFBpbm5lZCIsIm1hcENvbnRyb2xzIiwibWFwTGVnZW5kIiwic2hvdyIsImFjdGl2ZSIsInNwYWNlRm9yTGVnZW5kV2lkdGgiLCJtYXBDb250cm9sIiwicGlubmVkIiwicmlnaHQiLCJlbmxhcmdlZEZpbHRlcldpZHRoIiwiYW5pbWF0YWJsZUxheWVyIiwiZmlsdGVyIiwibCIsImNvbmZpZyIsImFuaW1hdGlvbiIsImVuYWJsZWQiLCJpc1Zpc2libGUiLCJyZWFkeVRvQW5pbWF0aW9uIiwiQXJyYXkiLCJpc0FycmF5IiwiZG9tYWluIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJjdXJyZW50VGltZSIsInNob3dGbG9hdGluZ1RpbWVEaXNwbGF5IiwibGVuZ3RoIiwic2hvd0FuaW1hdGlvbkNvbnRyb2wiLCJoaWRlQ29udHJvbCIsInNob3dUaW1lV2lkZ2V0IiwiT2JqZWN0Iiwia2V5cyIsIm9uQ2xvc2UiLCJzZXRGaWx0ZXJWaWV3IiwiRklMVEVSX1ZJRVdfVFlQRVMiLCJzaWRlIiwiTWF0aCIsIm1pbiIsIm1hcmdpblJpZ2h0Iiwic2V0TGF5ZXJBbmltYXRpb25UaW1lIiwic3RhcnQiLCJwYXVzZSIsInJlc2V0QW5pbWF0aW9uIiwidGltZWxpbmUiLCJzZXRUaW1lbGluZVZhbHVlIiwidXBkYXRlTGF5ZXJBbmltYXRpb25TcGVlZCIsInRvZ2dsZUxheWVyQW5pbWF0aW9uIiwic2V0RmlsdGVyQW5pbWF0aW9uVGltZSIsInNldEZpbHRlclBsb3QiLCJzZXRGaWx0ZXJBbmltYXRpb25XaW5kb3ciLCJ0b2dnbGVGaWx0ZXJBbmltYXRpb24iLCJ1cGRhdGVGaWx0ZXJBbmltYXRpb25TcGVlZCIsInJlZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUdBOztBQUVBOztBQUNBOztBQUNBOzs7O0FBRUEsSUFBTUEsUUFBUSxHQUFHLElBQWpCOztBQU9BLElBQU1DLHFCQUFxQixHQUFHQyw2QkFBT0MsR0FBVix3YkFHVixVQUFBQyxLQUFLO0FBQUEsU0FBS0EsS0FBSyxDQUFDQyxVQUFOLEdBQW1CRCxLQUFLLENB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UUFBQSxjQUFjLEVBQUVULGNBYmxCO0FBY0UsUUFBQSxZQUFZLEVBQUUsQ0FBQzVELGVBQUQsSUFBb0IsQ0FBQ0EsZUFBZSxDQUFDaUIsV0FkckQ7QUFlRSxRQUFBLE9BQU8sRUFBRWlDLE9BZlg7QUFnQkUsUUFBQSxRQUFRLEVBQUVXO0FBaEJaLFFBRFksR0FtQlYsSUFwQkw7QUFBQSxLQUxILENBREssR0E2QkgsSUF0RE4sQ0FERjtBQTBERCxHQXJIRDtBQXVIQTs7O0FBQ0EsU0FBTztBQUFBO0FBQ0w7QUFDQSx5QkFBVyxVQUFDdEYsS0FBRCxFQUFpQytGLEdBQWpDO0FBQUEsd0JBQXlDLGdDQUFDLFlBQUQsZ0NBQWtCL0YsS0FBbEI7QUFBeUIsTUFBQSxPQUFPLEVBQUUrRjtBQUFsQyxPQUF6QztBQUFBLEdBQVgsQ0FGSyxDQUFQO0FBSUE7QUFDRDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDIzIFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IFJlYWN0LCB7Zm9yd2FyZFJlZiwgdXNlTWVtbywgdXNlQ2FsbGJhY2t9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHt3aXRoVGhlbWV9IGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcblxuaW1wb3J0IHtGSUxURVJfVklFV19UWVBFU30gZnJvbSAnQGtlcGxlci5nbC9jb25zdGFudHMnO1xuaW1wb3J0IHtoYXNQb3J0YWJsZVdpZHRoLCBpc1NpZGVGaWx0ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvdXRpbHMnO1xuaW1wb3J0IHttZWRpYSwgYnJlYWtQb2ludFZhbHVlc30gZnJvbSAnQGtlcGxlci5nbC9zdHlsZXMnO1xuaW1wb3J0IHtUaW1lUmFuZ2VGaWx0ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuXG5pbXBvcnQgVGltZVdpZGdldEZhY3RvcnkgZnJvbSAnLi9maWx0ZXJzL3RpbWUtd2lkZ2V0JztcbmltcG9ydCB7Ym90dG9tV2lkZ2V0U2VsZWN0b3J9IGZyb20gJy4va2VwbGVyLWdsJztcbmltcG9ydCBGaWx0ZXJBbmltYXRpb25Db250cm9sbGVyRmFjdG9yeSBmcm9tICcuL2ZpbHRlci1hbmltYXRpb24tY29udHJvbGxlcic7XG5pbXBvcnQgTGF5ZXJBbmltYXRpb25Db250cm9sbGVyRmFjdG9yeSBmcm9tICcuL2xheWVyLWFuaW1hdGlvbi1jb250cm9sbGVyJztcbmltcG9ydCBBbmltYXRpb25Db250cm9sRmFjdG9yeSBmcm9tICcuL2NvbW1vbi9hbmltYXRpb24tY29udHJvbC9hbmltYXRpb24tY29udHJvbCc7XG5cbmNvbnN0IG1heFdpZHRoID0gMTA4MDtcblxuaW50ZXJmYWNlIEJvdHRvbVdpZGdldENvbnRhaW5lclByb3BzIHtcbiAgaGFzUGFkZGluZz86IGJvb2xlYW47XG4gIHdpZHRoPzogbnVtYmVyO1xufVxuXG5jb25zdCBCb3R0b21XaWRnZXRDb250YWluZXIgPSBzdHlsZWQuZGl2PEJvdHRvbVdpZGdldENvbnRhaW5lclByb3BzPmBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgcGFkZGluZy10b3A6ICR7cHJvcHMgPT4gKHByb3BzLmhhc1BhZGRpbmcgPyBwcm9wcy50aGVtZS5ib3R0b21XaWRnZXRQYWRkaW5nVG9wIDogMCl9cHg7XG4gIHBhZGRpbmctcmlnaHQ6ICR7cHJvcHMgPT4gKHByb3BzLmhhc1BhZGRpbmcgPyBwcm9wcy50aGVtZS5ib3R0b21XaWRnZXRQYWRkaW5nUmlnaHQgOiAwKX1weDtcbiAgcGFkZGluZy1ib3R0b206ICR7cHJvcHMgPT4gKHByb3BzLmhhc1BhZGRpbmcgPyBwcm9wcy50aGVtZS5ib3R0b21XaWRnZXRQYWRkaW5nQm90dG9tIDogMCl9cHg7XG4gIHBhZGRpbmctbGVmdDogJHtwcm9wcyA9PiAocHJvcHMuaGFzUGFkZGluZyA/IHByb3BzLnRoZW1lLmJvdHRvbVdpZGdldFBhZGRpbmdMZWZ0IDogMCl9cHg7XG4gIHBvaW50ZXItZXZlbnRzOiBub25lICFpbXBvcnRhbnQ7IC8qIHByZXZlbnQgcGFkZGluZyBmcm9tIGJsb2NraW5nIGlucHV0ICovXG4gICYgPiAqIHtcbiAgICAvKiBhbGwgY2hpbGRyZW4gc2hvdWxkIGFsbG93IGlucHV0ICovXG4gICAgcG9pbnRlci1ldmVudHM6IGFsbDtcbiAgfVxuICB3aWR0aDogJHtwcm9wcyA9PiBwcm9wcy53aWR0aH1weDtcbiAgei1pbmRleDogMTtcbiAgJHttZWRpYS5wb3J0YWJsZWBwYWRkaW5nOiAwO2B9XG5gO1xuXG5leHBvcnQgdHlwZSBCb3R0b21XaWRnZXRQcm9wcyA9IHtcbiAgcm9vdFJlZjogUmVhY3QuRm9yd2FyZGVkUmVmPEhUTUxEaXZFbGVtZW50PjtcbiAgY29udGFpbmVyVzogbnVtYmVyO1xufSAmIFJldHVyblR5cGU8dHlwZW9mIGJvdHRvbVdpZGdldFNlbGVjdG9yPjtcbnR5cGUgVGhlbWVQcm9wID0ge1xuICB0aGVtZTogUmVjb3JkPHN0cmluZywgYW55Pjtcbn07XG50eXBlIEJvdHRvbVdpZGdldFRoZW1lZFByb3BzID0gQm90dG9tV2lkZ2V0UHJvcHMgJiBUaGVtZVByb3A7XG5cbkJvdHRvbVdpZGdldEZhY3RvcnkuZGVwcyA9IFtcbiAgVGltZVdpZGdldEZhY3RvcnksXG4gIEFuaW1hdGlvbkNvbnRyb2xGYWN0b3J5LFxuICBGaWx0ZXJBbmltYXRpb25Db250cm9sbGVyRmFjdG9yeSxcbiAgTGF5ZXJBbmltYXRpb25Db250cm9sbGVyRmFjdG9yeVxuXTtcblxuLyogZXNsaW50LWRpc2FibGUgY29tcGxleGl0eSAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQm90dG9tV2lkZ2V0RmFjdG9yeShcbiAgVGltZVdpZGdldDogUmV0dXJuVHlwZTx0eXBlb2YgVGltZVdpZGdldEZhY3Rvcnk+LFxuICBBbmltYXRpb25Db250cm9sOiBSZXR1cm5UeXBlPHR5cGVvZiBBbmltYXRpb25Db250cm9sRmFjdG9yeT4sXG4gIEZpbHRlckFuaW1hdGlvbkNvbnRyb2xsZXI6IFJldHVyblR5cGU8dHlwZW9mIEZpbHRlckFuaW1hdGlvbkNvbnRyb2xsZXJGYWN0b3J5PixcbiAgTGF5ZXJBbmltYXRpb25Db250cm9sbGVyOiBSZXR1cm5UeXBlPHR5cGVvZiBMYXllckFuaW1hdGlvbkNvbnRyb2xsZXJGYWN0b3J5PlxuKTogUmVhY3QuRkM8Qm90dG9tV2lkZ2V0VGhlbWVkUHJvcHM+IHtcbiAgY29uc3QgTGF5ZXJBbmltYXRpb25Db250cm9sID0gc3R5bGVkKEFuaW1hdGlvbkNvbnRyb2wpYFxuICAgIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2lkZVBhbmVsQmd9O1xuICBgO1xuXG4gIGNvbnN0IEJvdHRvbVdpZGdldDogUmVhY3QuRkM8Qm90dG9tV2lkZ2V0VGhlbWVkUHJvcHM+ID0gKHByb3BzOiBCb3R0b21XaWRnZXRUaGVtZWRQcm9wcykgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGRhdGFzZXRzLFxuICAgICAgZmlsdGVycyxcbiAgICAgIGFuaW1hdGlvbkNvbmZpZyxcbiAgICAgIHZpc1N0YXRlQWN0aW9ucyxcbiAgICAgIGNvbnRhaW5lclcsXG4gICAgICB1aVN0YXRlLFxuICAgICAgc2lkZVBhbmVsV2lkdGgsXG4gICAgICBsYXllcnMsXG4gICAgICByb290UmVmLFxuICAgICAgdGhlbWVcbiAgICB9ID0gcHJvcHM7XG5cbiAgICBjb25zdCB7YWN0aXZlU2lkZVBhbmVsLCByZWFkT25seX0gPSB1aVN0YXRlO1xuICAgIGNvbnN0IGlzT3BlbiA9IEJvb2xlYW4oYWN0aXZlU2lkZVBhbmVsKTtcblxuICAgIGNvbnN0IGVubGFyZ2VkRmlsdGVySWR4ID0gdXNlTWVtbygoKSA9PiBmaWx0ZXJzLmZpbmRJbmRleChmID0+ICFpc1NpZGVGaWx0ZXIoZikpLCBbZmlsdGVyc10pO1xuXG4gICAgY29uc3QgaXNNb2JpbGUgPSBoYXNQb3J0YWJsZVdpZHRoKGJyZWFrUG9pbnRWYWx1ZXMpO1xuXG4gICAgY29uc3QgYW5pbWF0ZWRGaWx0ZXJJZHggPSB1c2VNZW1vKCgpID0+IGZpbHRlcnMuZmluZEluZGV4KGYgPT4gZi5pc0FuaW1hdGluZyksIFtmaWx0ZXJzXSk7XG4gICAgY29uc3QgYW5pbWF0ZWRGaWx0ZXIgPSBhbmltYXRlZEZpbHRlcklkeCA+IC0xID8gZmlsdGVyc1thbmltYXRlZEZpbHRlcklkeF0gOiBudWxsO1xuXG4gICAgY29uc3QgaXNMZWdlbmRQaW5uZWQgPVxuICAgICAgdWlTdGF0ZS5tYXBDb250cm9scz8ubWFwTGVnZW5kPy5zaG93ICYmIHVpU3RhdGUubWFwQ29udHJvbHM/Lm1hcExlZ2VuZD8uYWN0aXZlO1xuICAgIGNvbnN0IHNwYWNlRm9yTGVnZW5kV2lkdGggPSBpc0xlZ2VuZFBpbm5lZFxuICAgICAgPyB0aGVtZS5tYXBDb250cm9sPy53aWR0aCArXG4gICAgICAgIHRoZW1lLm1hcENvbnRyb2w/Lm1hcExlZ2VuZD8ucGlubmVkPy5yaWdodCAqIDIgLVxuICAgICAgICB0aGVtZS5ib3R0b21XaWRnZXRQYWRkaW5nUmlnaHRcbiAgICAgIDogMDtcblxuICAgIGNvbnN0IGVubGFyZ2VkRmlsdGVyV2lkdGggPVxuICAgICAgKGlzT3BlbiAmJiAhaXNNb2JpbGUgPyBjb250YWluZXJXIC0gc2lkZVBhbmVsV2lkdGggOiBjb250YWluZXJXKSAtIHNwYWNlRm9yTGVnZW5kV2lkdGg7XG5cbiAgICAvLyBzaG93IHBsYXliYWNrIGNvbnRyb2wgaWYgbGF5ZXJzIGNvbnRhaW4gdHJpcCBsYXllciAmIGF0IGxlYXN0IG9uZSB0cmlwIGxheWVyIGlzIHZpc2libGVcbiAgICBjb25zdCBhbmltYXRhYmxlTGF5ZXIgPSB1c2VNZW1vKFxuICAgICAgKCkgPT5cbiAgICAgICAgbGF5ZXJzLmZpbHRlcihsID0+IGwuY29uZmlnLmFuaW1hdGlvbiAmJiBsLmNvbmZpZy5hbmltYXRpb24uZW5hYmxlZCAmJiBsLmNvbmZpZy5pc1Zpc2libGUpLFxuICAgICAgW2xheWVyc11cbiAgICApO1xuXG4gICAgY29uc3QgcmVhZHlUb0FuaW1hdGlvbiA9XG4gICAgICBBcnJheS5pc0FycmF5KGFuaW1hdGlvbkNvbmZpZy5kb21haW4pICYmIE51bWJlci5pc0Zpbml0ZShhbmltYXRpb25Db25maWcuY3VycmVudFRpbWUpO1xuICAgIC8vIGlmIGFuaW1hdGlvbiBjb250cm9sIGlzIHNob3dpbmcsIGhpZGUgdGltZSBkaXNwbGF5IGluIHRpbWUgc2xpZGVyXG4gICAgY29uc3Qgc2hvd0Zsb2F0aW5nVGltZURpc3BsYXkgPSAhYW5pbWF0YWJsZUxheWVyLmxlbmd0aDtcbiAgICBjb25zdCBzaG93QW5pbWF0aW9uQ29udHJvbCA9XG4gICAgICBhbmltYXRhYmxlTGF5ZXIubGVuZ3RoICYmIHJlYWR5VG9BbmltYXRpb24gJiYgIWFuaW1hdGlvbkNvbmZpZy5oaWRlQ29udHJvbDtcbiAgICBjb25zdCBzaG93VGltZVdpZGdldCA9IGVubGFyZ2VkRmlsdGVySWR4ID4gLTEgJiYgT2JqZWN0LmtleXMoZGF0YXNldHMpLmxlbmd0aCA+IDA7XG5cbiAgICAvLyBpZiBmaWx0ZXIgaXMgbm90IGFuaW1hdGluZywgcGFzcyBpbiBlbmxhcmdlZCBmaWx0ZXIgaGVyZSBiZWNhdXNlXG4gICAgLy8gYW5pbWF0aW9uIGNvbnRyb2xsZXIgbmVlZHMgdG8gY2FsbCByZXNldCBvbiBpdFxuICAgIGNvbnN0IGZpbHRlciA9IChhbmltYXRlZEZpbHRlciBhcyBUaW1lUmFuZ2VGaWx0ZXIpIHx8IGZpbHRlcnNbZW5sYXJnZWRGaWx0ZXJJZHhdO1xuXG4gICAgY29uc3Qgb25DbG9zZSA9IHVzZUNhbGxiYWNrKFxuICAgICAgKCkgPT4gdmlzU3RhdGVBY3Rpb25zLnNldEZpbHRlclZpZXcoZW5sYXJnZWRGaWx0ZXJJZHgsIEZJTFRFUl9WSUVXX1RZUEVTLnNpZGUpLFxuICAgICAgW3Zpc1N0YXRlQWN0aW9ucywgZW5sYXJnZWRGaWx0ZXJJZHhdXG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Qm90dG9tV2lkZ2V0Q29udGFpbmVyXG4gICAgICAgIHdpZHRoPXtNYXRoLm1pbihtYXhXaWR0aCwgZW5sYXJnZWRGaWx0ZXJXaWR0aCl9XG4gICAgICAgIHN0eWxlPXt7bWFyZ2luUmlnaHQ6IHNwYWNlRm9yTGVnZW5kV2lkdGh9fVxuICAgICAgICBjbGFzc05hbWU9XCJib3R0b20td2lkZ2V0LS1jb250YWluZXJcIlxuICAgICAgICBoYXNQYWRkaW5nPXtzaG93QW5pbWF0aW9uQ29udHJvbCB8fCBzaG93VGltZVdpZGdldH1cbiAgICAgICAgcmVmPXtyb290UmVmfVxuICAgICAgPlxuICAgICAgICA8TGF5ZXJBbmltYXRpb25Db250cm9sbGVyXG4gICAgICAgICAgYW5pbWF0aW9uQ29uZmlnPXthbmltYXRpb25Db25maWd9XG4gICAgICAgICAgc2V0TGF5ZXJBbmltYXRpb25UaW1lPXt2aXNTdGF0ZUFjdGlvbnMuc2V0TGF5ZXJBbmltYXRpb25UaW1lfVxuICAgICAgICA+XG4gICAgICAgICAgeyhpc0FuaW1hdGluZywgc3RhcnQsIHBhdXNlLCByZXNldEFuaW1hdGlvbiwgdGltZWxpbmUsIHNldFRpbWVsaW5lVmFsdWUpID0+XG4gICAgICAgICAgICBzaG93QW5pbWF0aW9uQ29udHJvbCA/IChcbiAgICAgICAgICAgICAgPExheWVyQW5pbWF0aW9uQ29udHJvbFxuICAgICAgICAgICAgICAgIHVwZGF0ZUFuaW1hdGlvblNwZWVkPXt2aXNTdGF0ZUFjdGlvbnMudXBkYXRlTGF5ZXJBbmltYXRpb25TcGVlZH1cbiAgICAgICAgICAgICAgICB0b2dnbGVBbmltYXRpb249e3Zpc1N0YXRlQWN0aW9ucy50b2dnbGVMYXllckFuaW1hdGlvbn1cbiAgICAgICAgICAgICAgICBpc0FuaW1hdGFibGU9eyFhbmltYXRlZEZpbHRlcn1cbiAgICAgICAgICAgICAgICBpc0FuaW1hdGluZz17aXNBbmltYXRpbmd9XG4gICAgICAgICAgICAgICAgcmVzZXRBbmltYXRpb249e3Jlc2V0QW5pbWF0aW9ufVxuICAgICAgICAgICAgICAgIHNldFRpbWVsaW5lVmFsdWU9e3NldFRpbWVsaW5lVmFsdWV9XG4gICAgICAgICAgICAgICAgdGltZWxpbmU9e3RpbWVsaW5lfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSA6IG51bGxcbiAgICAgICAgICB9XG4gICAgICAgIDwvTGF5ZXJBbmltYXRpb25Db250cm9sbGVyPlxuICAgICAgICB7ZmlsdGVyID8gKFxuICAgICAgICAgIDxGaWx0ZXJBbmltYXRpb25Db250cm9sbGVyXG4gICAgICAgICAgICBmaWx0ZXI9e2ZpbHRlcn1cbiAgICAgICAgICAgIGZpbHRlcklkeD17YW5pbWF0ZWRGaWx0ZXJJZHggPiAtMSA/IGFuaW1hdGVkRmlsdGVySWR4IDogZW5sYXJnZWRGaWx0ZXJJZHh9XG4gICAgICAgICAgICBzZXRGaWx0ZXJBbmltYXRpb25UaW1lPXt2aXNTdGF0ZUFjdGlvbnMuc2V0RmlsdGVyQW5pbWF0aW9uVGltZX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7KGlzQW5pbWF0aW5nLCBzdGFydCwgcGF1c2UsIHJlc2V0QW5pbWF0aW9uLCB0aW1lbGluZSwgc2V0VGltZWxpbmVWYWx1ZSkgPT5cbiAgICAgICAgICAgICAgc2hvd1RpbWVXaWRnZXQgPyAoXG4gICAgICAgICAgICAgICAgPFRpbWVXaWRnZXRcbiAgICAgICAgICAgICAgICAgIC8vIFRpbWVXaWRnZXQgdXNlcyBSZWFjdC5tZW1vLCBoZXJlIHdlIHBhc3Mgd2lkdGhcbiAgICAgICAgICAgICAgICAgIC8vIGV2ZW4gdGhvdWdoIGl0IGRvZXNudCB1c2UgaXQsIHRvIGZvcmNlIHJlcmVuZGVyXG4gICAgICAgICAgICAgICAgICBmaWx0ZXI9e2ZpbHRlcnNbZW5sYXJnZWRGaWx0ZXJJZHhdIGFzIFRpbWVSYW5nZUZpbHRlcn1cbiAgICAgICAgICAgICAgICAgIGluZGV4PXtlbmxhcmdlZEZpbHRlcklkeH1cbiAgICAgICAgICAgICAgICAgIGRhdGFzZXRzPXtkYXRhc2V0c31cbiAgICAgICAgICAgICAgICAgIHJlYWRPbmx5PXtyZWFkT25seX1cbiAgICAgICAgICAgICAgICAgIHNob3dUaW1lRGlzcGxheT17c2hvd0Zsb2F0aW5nVGltZURpc3BsYXl9XG4gICAgICAgICAgICAgICAgICBzZXRGaWx0ZXJQbG90PXt2aXNTdGF0ZUFjdGlvbnMuc2V0RmlsdGVyUGxvdH1cbiAgICAgICAgICAgICAgICAgIHNldEZpbHRlckFuaW1hdGlvblRpbWU9e3NldFRpbWVsaW5lVmFsdWV9XG4gICAgICAgICAgICAgICAgICBzZXRGaWx0ZXJBbmltYXRpb25XaW5kb3c9e3Zpc1N0YXRlQWN0aW9ucy5zZXRGaWx0ZXJBbmltYXRpb25XaW5kb3d9XG4gICAgICAgICAgICAgICAgICB0b2dnbGVBbmltYXRpb249e3Zpc1N0YXRlQWN0aW9ucy50b2dnbGVGaWx0ZXJBbmltYXRpb259XG4gICAgICAgICAgICAgICAgICB1cGRhdGVBbmltYXRpb25TcGVlZD17dmlzU3RhdGVBY3Rpb25zLnVwZGF0ZUZpbHRlckFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgICAgICAgICAgcmVzZXRBbmltYXRpb249e3Jlc2V0QW5pbWF0aW9ufVxuICAgICAgICAgICAgICAgICAgaXNBbmltYXRhYmxlPXshYW5pbWF0aW9uQ29uZmlnIHx8ICFhbmltYXRpb25Db25maWcuaXNBbmltYXRpbmd9XG4gICAgICAgICAgICAgICAgICBvbkNsb3NlPXtvbkNsb3NlfVxuICAgICAgICAgICAgICAgICAgdGltZWxpbmU9e3RpbWVsaW5lfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICkgOiBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9GaWx0ZXJBbmltYXRpb25Db250cm9sbGVyPlxuICAgICAgICApIDogbnVsbH1cbiAgICAgIDwvQm90dG9tV2lkZ2V0Q29udGFpbmVyPlxuICAgICk7XG4gIH07XG5cbiAgLyogZXNsaW50LWRpc2FibGUgcmVhY3QvZGlzcGxheS1uYW1lICovXG4gIHJldHVybiB3aXRoVGhlbWUoXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGZvcndhcmRSZWYoKHByb3BzOiBCb3R0b21XaWRnZXRUaGVtZWRQcm9wcywgcmVmKSA9PiA8Qm90dG9tV2lkZ2V0IHsuLi5wcm9wc30gcm9vdFJlZj17cmVmfSAvPilcbiAgKTtcbiAgLyogZXNsaW50LWVuYWJsZSByZWFjdC9kaXNwbGF5LW5hbWUgKi9cbn1cbi8qIGVzbGludC1lbmFibGUgY29tcGxleGl0eSAqL1xuIl19