"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = SidePanelFactory;
exports.StyledSidePanelContent = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _constants = require("@kepler.gl/constants");

var _icons = require("./common/icons");

var _sideBar = _interopRequireDefault(require("./side-panel/side-bar"));

var _panelHeader = _interopRequireDefault(require("./side-panel/panel-header"));

var _panelToggle = _interopRequireDefault(require("./side-panel/panel-toggle"));

var _layerManager = _interopRequireDefault(require("./side-panel/layer-manager"));

var _filterManager = _interopRequireDefault(require("./side-panel/filter-manager"));

var _interactionManager = _interopRequireDefault(require("./side-panel/interaction-manager"));

var _mapManager = _interopRequireDefault(require("./side-panel/map-manager"));

var _customPanel = _interopRequireDefault(require("./side-panel/custom-panel"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _lodash = _interopRequireDefault(require("lodash.get"));

var _templateObject;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var StyledSidePanelContent = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  ", ";\n  flex-grow: 1;\n  padding: ", "px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n\n  .side-panel__content__inner {\n    display: flex;\n    height: 100%;\n    flex-direction: column;\n  }\n"])), function (props) {
  return props.theme.sidePanelScrollBar;
}, function (props) {
  return props.theme.sidePanelInnerPadding;
});

exports.StyledSidePanelContent = StyledSidePanelContent;
SidePanelFactory.deps = [_sideBar["default"], _panelHeader["default"], _panelToggle["default"], _layerManager["default"], _filterManager["default"], _interactionManager["default"], _mapManager["default"], _customPanel["default"]];
/**
 * Vertical sidebar containing input components for the rendering layers
 */

function SidePanelFactory(Sidebar, PanelHeader, PanelToggle, LayerManager, FilterManager, InteractionManager, MapManager, CustomPanels) {
  // inject components
  var SIDEBAR_COMPONENTS = {
    layer: LayerManager,
    filter: FilterManager,
    interaction: InteractionManager,
    map: MapManager
  };
  var SIDEBAR_ICONS = {
    layer: _icons.Layers,
    filter: _icons.FilterFunnel,
    interaction: _icons.Settings,
    map: _icons.CursorClick
  }; // We should defined sidebar panels here but keeping them for backward compatible

  var fullPanels = _constants.SIDEBAR_PANELS.map(function (component) {
    return _objectSpread(_objectSpread({}, component), {}, {
      component: SIDEBAR_COMPONENTS[component.id],
      iconComponent: SIDEBAR_ICONS[component.id]
    });
  });

  var getCustomPanelProps = (0, _lodash["default"])(CustomPanels, ['defaultProps', 'getProps']) || function () {
    return {};
  }; // eslint-disable-next-line max-statements


  var SidePanel = function SidePanel(props) {
    var appName = props.appName,
        appWebsite = props.appWebsite,
        availableProviders = props.availableProviders,
        datasets = props.datasets,
        filters = props.filters,
        layers = props.layers,
        layerBlending = props.layerBlending,
        overlayBlending = props.overlayBlending,
        layerClasses = props.layerClasses,
        layerOrder = props.layerOrder,
        interactionConfig = props.interactionConfig,
        panels = props.panels,
        mapInfo = props.mapInfo,
        mapSaved = props.mapSaved,
        mapStateActions = props.mapStateActions,
        mapStyle = props.mapStyle,
        mapStyleActions = props.mapStyleActions,
        onSaveMap = props.onSaveMap,
        uiState = props.uiState,
        uiStateActions = props.uiStateActions,
        visStateActions = props.visStateActions,
        version = props.version,
        width = props.width;
    var openDeleteModal = uiStateActions.openDeleteModal,
        toggleModal = uiStateActions.toggleModal,
        toggleSidePanel = uiStateActions.toggleSidePanel;
    var activeSidePanel = uiState.activeSidePanel;
    var setMapInfo = visStateActions.setMapInfo,
        showDatasetTable = visStateActions.showDatasetTable,
        updateTableColor = visStateActions.updateTableColor;
    var hasShare = availableProviders.hasShare,
        hasStorage = availableProviders.hasStorage;
    var title = mapInfo.title;
    var isOpen = Boolean(activeSidePanel);

    var _onOpenOrClose = (0, _react.useCallback)(function () {
      return toggleSidePanel(activeSidePanel ? '' : 'layer');
    }, [activeSidePanel, toggleSidePanel]);

    var onClickExportImage = (0, _react.useCallback)(function () {
      return toggleModal(_constants.EXPORT_IMAGE_ID);
    }, [toggleModal]);
    var onClickExportData = (0, _react.useCallback)(function () {
      return toggleModal(_constants.EXPORT_DATA_ID);
    }, [toggleModal]);
    var onClickExportMap = (0, _react.useCallback)(function () {
      return toggleModal(_constants.EXPORT_MAP_ID);
    }, [toggleModal]);
    var onClickSaveToStorage = (0, _react.useCallback)(function () {
      return toggleModal(mapSaved ? _constants.OVERWRITE_MAP_ID : _constants.SAVE_MAP_ID);
    }, [mapSaved, toggleModal]);
    var onClickSaveAsToStorage = (0, _react.useCallback)(function () {
      setMapInfo({
        title: "".concat(title || 'Kepler.gl', " (Copy)")
      });
      toggleModal(_constants.SAVE_MAP_ID);
    }, [title, setMapInfo, toggleModal]);
    var onClickShareMap = (0, _react.useCallback)(function () {
      return toggleModal(_constants.SHARE_MAP_ID);
    }, [toggleModal]);
    var onShowDatasetTable = (0, _react.useCallback)(function (dataId) {
      return showDatasetTable(dataId);
    }, [showDatasetTable]);
    var onUpdateTableColor = (0, _react.useCallback)(function (dataId, newColor) {
      return updateTableColor(dataId, newColor);
    }, [updateTableColor]);
    var onShowAddDataModal = (0, _react.useCallback)(function () {
      return toggleModal(_constants.ADD_DATA_ID);
    }, [toggleModal]);
    var onShowAddMapStyleModal = (0, _react.useCallback)(function () {
      return toggleModal(_constants.ADD_MAP_STYLE_ID);
    }, [toggleModal]);
    var onRemoveDataset = (0, _react.useCallback)(function (dataId) {
      return openDeleteModal(dataId);
    }, [openDeleteModal]);
    var onSaveToStorage = (0, _react.useMemo)(function () {
      return hasStorage ? onClickSaveToStorage : null;
    }, [hasStorage, onClickSaveToStorage]);
    var onSaveAsToStorage = (0, _react.useMemo)(function () {
      return hasStorage && mapSaved ? onClickSaveAsToStorage : null;
    }, [hasStorage, mapSaved, onClickSaveAsToStorage]);
    var currentPanel = (0, _react.useMemo)(function () {
      return panels.find(function (_ref) {
        var id = _ref.id;
        return id === activeSidePanel;
      });
    }, [activeSidePanel, panels]);
    var onShareMap = (0, _react.useMemo)(function () {
      return hasShare ? onClickShareMap : null;
    }, [hasShare, onClickShareMap]);
    var customPanelProps = (0, _react.useMemo)(function () {
      return getCustomPanelProps(props);
    }, [props]);
    var PanelComponent = currentPanel === null || currentPanel === void 0 ? void 0 : currentPanel.component;
    return /*#__PURE__*/_react["default"].createElement(Sidebar, {
      width: width,
      isOpen: isOpen,
      shouldShowCollapseButton: uiState.isSidePanelCloseButtonVisible,
      minifiedWidth: 0,
      onOpenOrClose: _onOpenOrClose
    }, /*#__PURE__*/_react["default"].createElement(PanelHeader, {
      appName: appName,
      version: version,
      appWebsite: appWebsite,
      visibleDropdown: uiState.visibleDropdown,
      showExportDropdown: uiStateActions.showExportDropdown,
      hideExportDropdown: uiStateActions.hideExportDropdown,
      onExportImage: onClickExportImage,
      onExportData: onClickExportData,
      onExportMap: onClickExportMap,
      onSaveMap: onSaveMap,
      onSaveToStorage: onSaveToStorage,
      onSaveAsToStorage: onSaveAsToStorage,
      onShareMap: onShareMap
    }), /*#__PURE__*/_react["default"].createElement(PanelToggle, {
      panels: panels,
      activePanel: activeSidePanel,
      togglePanel: uiStateActions.toggleSidePanel
    }), /*#__PURE__*/_react["default"].createElement(StyledSidePanelContent, {
      className: "side-panel__content"
    }, /*#__PURE__*/_react["default"].createElement("div", {
      className: "side-panel__content__inner"
    }, PanelComponent ? /*#__PURE__*/_react["default"].createElement(PanelComponent, {
      datasets: datasets,
      filters: filters,
      layers: layers,
      layerClasses: layerClasses,
      layerOrder: layerOrder,
      layerBlending: layerBlending,
      overlayBlending: overlayBlending,
      mapStyle: mapStyle,
      mapStyleActions: mapStyleActions,
      mapStateActions: mapStateActions,
      interactionConfig: interactionConfig,
      removeDataset: onRemoveDataset,
      showDatasetTable: onShowDatasetTable,
      updateTableColor: onUpdateTableColor,
      showAddDataModal: onShowAddDataModal,
      showAddMapStyleModal: onShowAddMapStyleModal,
      uiStateActions: uiStateActions,
      visStateActions: visStateActions,
      panelMetadata: currentPanel,
      panelListView: (currentPanel === null || currentPanel === void 0 ? void 0 : currentPanel.id) === 'layer' ? uiState.layerPanelListView : (currentPanel === null || currentPanel === void 0 ? void 0 : currentPanel.id) === 'filter' ? uiState.filterPanelListView : null
    }) : null, /*#__PURE__*/_react["default"].createElement(CustomPanels, (0, _extends2["default"])({}, customPanelProps, {
      activeSidePanel: activeSidePanel,
      updateTableColor: onUpdateTableColor
    })))));
  };

  SidePanel.defaultProps = {
    panels: fullPanels,
    sidebarComponents: SIDEBAR_COMPONENTS,
    uiState: {},
    visStateActions: {},
    mapStyleActions: {},
    uiStateActions: {},
    availableProviders: {},
    mapInfo: {}
  };
  return SidePanel;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL3NyYy9zaWRlLXBhbmVsLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWRTaWRlUGFuZWxDb250ZW50Iiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ0aGVtZSIsInNpZGVQYW5lbFNjcm9sbEJhciIsInNpZGVQYW5lbElubmVyUGFkZGluZyIsIlNpZGVQYW5lbEZhY3RvcnkiLCJkZXBzIiwiU2lkZWJhckZhY3RvcnkiLCJQYW5lbEhlYWRlckZhY3RvcnkiLCJQYW5lbFRvZ2dsZUZhY3RvcnkiLCJMYXllck1hbmFnZXJGYWN0b3J5IiwiRmlsdGVyTWFuYWdlckZhY3RvcnkiLCJJbnRlcmFjdGlvbk1hbmFnZXJGYWN0b3J5IiwiTWFwTWFuYWdlckZhY3RvcnkiLCJDdXN0b21QYW5lbHNGYWN0b3J5IiwiU2lkZWJhciIsIlBhbmVsSGVhZGVyIiwiUGFuZWxUb2dnbGUiLCJMYXllck1hbmFnZXIiLCJGaWx0ZXJNYW5hZ2VyIiwiSW50ZXJhY3Rpb25NYW5hZ2VyIiwiTWFwTWFuYWdlciIsIkN1c3RvbVBhbmVscyIsIlNJREVCQVJfQ09NUE9ORU5UUyIsImxheWVyIiwiZmlsdGVyIiwiaW50ZXJhY3Rpb24iLCJtYXAiLCJTSURFQkFSX0lDT05TIiwiTGF5ZXJzIiwiRmlsdGVyRnVubmVsIiwiU2V0dGluZ3MiLCJDdXJzb3JDbGljayIsImZ1bGxQYW5lbHMiLCJTSURFQkFSX1BBTkVMUyIsImNvbXBvbmVudCIsImlkIiwiaWNvbkNvbXBvbmVudCIsImdldEN1c3RvbVBhbmVsUHJvcHMiLCJTaWRlUGFuZWwiLCJhcHBOYW1lIiwiYXBwV2Vic2l0ZSIsImF2YWlsYWJsZVByb3ZpZGVycyIsImRhdGFzZXRzIiwiZmlsdGVycyIsImxheWVycyIsImxheWVyQmxlbmRpbmciLCJvdmVybGF5QmxlbmRpbmciLCJsYXllckNsYXNzZXMiLCJsYXllck9yZGVyIiwiaW50ZXJhY3Rpb25Db25maWciLCJwYW5lbHMiLCJtYXBJbmZvIiwibWFwU2F2ZWQiLCJtYXBTdGF0ZUFjdGlvbnMiLCJtYXBTdHlsZSIsIm1hcFN0eWxlQWN0aW9ucyIsIm9uU2F2ZU1hcCIsInVpU3RhdGUiLCJ1aVN0YXRlQWN0aW9ucyIsInZpc1N0YXRlQWN0aW9ucyIsInZlcnNpb24iLCJ3aWR0aCIsIm9wZW5EZWxldGVNb2RhbCIsInRvZ2dsZU1vZGFsIiwidG9nZ2xlU2lkZVBhbmVsIiwiYWN0aXZlU2lkZVBhbmVsIiwic2V0TWFwSW5mbyIsInNob3dEYXRhc2V0VGFibGUiLCJ1cGRhdGVUYWJsZUNvbG9yIiwiaGFzU2hhcmUiLCJoYXNTdG9yYWdlIiwidGl0bGUiLCJpc09wZW4iLCJCb29sZWFuIiwiX29uT3Blbk9yQ2xvc2UiLCJvbkNsaWNrRXhwb3J0SW1hZ2UiLCJFWFBPUlRfSU1BR0VfSUQiLCJvbkNsaWNrRXhwb3J0RGF0YSIsIkVYUE9SVF9EQVRBX0lEIiwib25DbGlja0V4cG9ydE1hcCIsIkVYUE9SVF9NQVBfSUQiLCJvbkNsaWNrU2F2ZVRvU3RvcmFnZSIsIk9WRVJXUklURV9NQVBfSUQiLCJTQVZFX01BUF9JRCIsIm9uQ2xpY2tTYXZlQXNUb1N0b3JhZ2UiLCJvbkNsaWNrU2hhcmVNYXAiLCJTSEFSRV9NQVBfSUQiLCJvblNob3dEYXRhc2V0VGFibGUiLCJkYXRhSWQiLCJvblVwZGF0ZVRhYmxlQ29sb3IiLCJuZXdDb2xvciIsIm9uU2hvd0FkZERhdGFNb2RhbCIsIkFERF9EQVRBX0lEIiwib25TaG93QWRkTWFwU3R5bGVNb2RhbCIsIkFERF9NQVBfU1RZTEVfSUQiLCJvblJlbW92ZURhdGFzZXQiLCJvblNhdmVUb1N0b3JhZ2UiLCJvblNhdmVBc1RvU3RvcmFnZSIsImN1cnJlbnRQYW5lbCIsImZpbmQiLCJvblNoYXJlTWFwIiwiY3VzdG9tUGFuZWxQcm9wcyIsIlBhbmVsQ29tcG9uZW50IiwiaXNTaWRlUGFuZWxDbG9zZUJ1dHRvblZpc2libGUiLCJ2aXNpYmxlRHJvcGRvd24iLCJzaG93RXhwb3J0RHJvcGRvd24iLCJoaWRlRXhwb3J0RHJvcGRvd24iLCJsYXllclBhbmVsTGlzdFZpZXciLCJmaWx0ZXJQYW5lbExpc3RWaWV3IiwiZGVmYXVsdFByb3BzIiwic2lkZWJhckNvbXBvbmVudHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7QUFFQTs7QUFZQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7Ozs7Ozs7QUFHTyxJQUFNQSxzQkFBc0IsR0FBR0MsNkJBQU9DLEdBQVYsaVNBQy9CLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsa0JBQWhCO0FBQUEsQ0FEMEIsRUFHdEIsVUFBQUYsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZRSxxQkFBaEI7QUFBQSxDQUhpQixDQUE1Qjs7O0FBY1BDLGdCQUFnQixDQUFDQyxJQUFqQixHQUF3QixDQUN0QkMsbUJBRHNCLEVBRXRCQyx1QkFGc0IsRUFHdEJDLHVCQUhzQixFQUl0QkMsd0JBSnNCLEVBS3RCQyx5QkFMc0IsRUFNdEJDLDhCQU5zQixFQU90QkMsc0JBUHNCLEVBUXRCQyx1QkFSc0IsQ0FBeEI7QUFXQTtBQUNBO0FBQ0E7O0FBQ2UsU0FBU1QsZ0JBQVQsQ0FDYlUsT0FEYSxFQUViQyxXQUZhLEVBR2JDLFdBSGEsRUFJYkMsWUFKYSxFQUtiQyxhQUxhLEVBTWJDLGtCQU5hLEVBT2JDLFVBUGEsRUFRYkMsWUFSYSxFQVNiO0FBQ0E7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRztBQUN6QkMsSUFBQUEsS0FBSyxFQUFFTixZQURrQjtBQUV6Qk8sSUFBQUEsTUFBTSxFQUFFTixhQUZpQjtBQUd6Qk8sSUFBQUEsV0FBVyxFQUFFTixrQkFIWTtBQUl6Qk8sSUFBQUEsR0FBRyxFQUFFTjtBQUpvQixHQUEzQjtBQU9BLE1BQU1PLGFBQWEsR0FBRztBQUNwQkosSUFBQUEsS0FBSyxFQUFFSyxhQURhO0FBRXBCSixJQUFBQSxNQUFNLEVBQUVLLG1CQUZZO0FBR3BCSixJQUFBQSxXQUFXLEVB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QSxrQkFBa0IsRUFBRSxFQVBHO0FBUXZCVSxJQUFBQSxPQUFPLEVBQUU7QUFSYyxHQUF6QjtBQVdBLFNBQU9iLFNBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMyBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7XG4gIEVYUE9SVF9EQVRBX0lELFxuICBFWFBPUlRfTUFQX0lELFxuICBTSEFSRV9NQVBfSUQsXG4gIFNJREVCQVJfUEFORUxTLFxuICBPVkVSV1JJVEVfTUFQX0lELFxuICBTQVZFX01BUF9JRCxcbiAgRVhQT1JUX0lNQUdFX0lELFxuICBBRERfREFUQV9JRCxcbiAgQUREX01BUF9TVFlMRV9JRFxufSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5cbmltcG9ydCB7Q3Vyc29yQ2xpY2ssIExheWVycywgRmlsdGVyRnVubmVsLCBTZXR0aW5nc30gZnJvbSAnLi9jb21tb24vaWNvbnMnO1xuXG5pbXBvcnQgU2lkZWJhckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL3NpZGUtYmFyJztcbmltcG9ydCBQYW5lbEhlYWRlckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL3BhbmVsLWhlYWRlcic7XG5pbXBvcnQgUGFuZWxUb2dnbGVGYWN0b3J5IGZyb20gJy4vc2lkZS1wYW5lbC9wYW5lbC10b2dnbGUnO1xuaW1wb3J0IExheWVyTWFuYWdlckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL2xheWVyLW1hbmFnZXInO1xuaW1wb3J0IEZpbHRlck1hbmFnZXJGYWN0b3J5IGZyb20gJy4vc2lkZS1wYW5lbC9maWx0ZXItbWFuYWdlcic7XG5pbXBvcnQgSW50ZXJhY3Rpb25NYW5hZ2VyRmFjdG9yeSBmcm9tICcuL3NpZGUtcGFuZWwvaW50ZXJhY3Rpb24tbWFuYWdlcic7XG5pbXBvcnQgTWFwTWFuYWdlckZhY3RvcnkgZnJvbSAnLi9zaWRlLXBhbmVsL21hcC1tYW5hZ2VyJztcbmltcG9ydCBDdXN0b21QYW5lbHNGYWN0b3J5IGZyb20gJy4vc2lkZS1wYW5lbC9jdXN0b20tcGFuZWwnO1xuXG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBnZXQgZnJvbSAnbG9kYXNoLmdldCc7XG5pbXBvcnQge1NpZGVQYW5lbFByb3BzfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNvbnN0IFN0eWxlZFNpZGVQYW5lbENvbnRlbnQgPSBzdHlsZWQuZGl2YFxuICAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNpZGVQYW5lbFNjcm9sbEJhcn07XG4gIGZsZXgtZ3JvdzogMTtcbiAgcGFkZGluZzogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zaWRlUGFuZWxJbm5lclBhZGRpbmd9cHg7XG4gIG92ZXJmbG93LXk6IHNjcm9sbDtcbiAgb3ZlcmZsb3cteDogaGlkZGVuO1xuXG4gIC5zaWRlLXBhbmVsX19jb250ZW50X19pbm5lciB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgfVxuYDtcblxuU2lkZVBhbmVsRmFjdG9yeS5kZXBzID0gW1xuICBTaWRlYmFyRmFjdG9yeSxcbiAgUGFuZWxIZWFkZXJGYWN0b3J5LFxuICBQYW5lbFRvZ2dsZUZhY3RvcnksXG4gIExheWVyTWFuYWdlckZhY3RvcnksXG4gIEZpbHRlck1hbmFnZXJGYWN0b3J5LFxuICBJbnRlcmFjdGlvbk1hbmFnZXJGYWN0b3J5LFxuICBNYXBNYW5hZ2VyRmFjdG9yeSxcbiAgQ3VzdG9tUGFuZWxzRmFjdG9yeVxuXTtcblxuLyoqXG4gKiBWZXJ0aWNhbCBzaWRlYmFyIGNvbnRhaW5pbmcgaW5wdXQgY29tcG9uZW50cyBmb3IgdGhlIHJlbmRlcmluZyBsYXllcnNcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU2lkZVBhbmVsRmFjdG9yeShcbiAgU2lkZWJhcjogUmV0dXJuVHlwZTx0eXBlb2YgU2lkZWJhckZhY3Rvcnk+LFxuICBQYW5lbEhlYWRlcjogUmV0dXJuVHlwZTx0eXBlb2YgUGFuZWxIZWFkZXJGYWN0b3J5PixcbiAgUGFuZWxUb2dnbGU6IFJldHVyblR5cGU8dHlwZW9mIFBhbmVsVG9nZ2xlRmFjdG9yeT4sXG4gIExheWVyTWFuYWdlcjogUmV0dXJuVHlwZTx0eXBlb2YgTGF5ZXJNYW5hZ2VyRmFjdG9yeT4sXG4gIEZpbHRlck1hbmFnZXI6IFJldHVyblR5cGU8dHlwZW9mIEZpbHRlck1hbmFnZXJGYWN0b3J5PixcbiAgSW50ZXJhY3Rpb25NYW5hZ2VyOiBSZXR1cm5UeXBlPHR5cGVvZiBJbnRlcmFjdGlvbk1hbmFnZXJGYWN0b3J5PixcbiAgTWFwTWFuYWdlcjogUmV0dXJuVHlwZTx0eXBlb2YgTWFwTWFuYWdlckZhY3Rvcnk+LFxuICBDdXN0b21QYW5lbHM6IFJldHVyblR5cGU8dHlwZW9mIEN1c3RvbVBhbmVsc0ZhY3Rvcnk+XG4pIHtcbiAgLy8gaW5qZWN0IGNvbXBvbmVudHNcbiAgY29uc3QgU0lERUJBUl9DT01QT05FTlRTID0ge1xuICAgIGxheWVyOiBMYXllck1hbmFnZXIsXG4gICAgZmlsdGVyOiBGaWx0ZXJNYW5hZ2VyLFxuICAgIGludGVyYWN0aW9uOiBJbnRlcmFjdGlvbk1hbmFnZXIsXG4gICAgbWFwOiBNYXBNYW5hZ2VyXG4gIH07XG5cbiAgY29uc3QgU0lERUJBUl9JQ09OUyA9IHtcbiAgICBsYXllcjogTGF5ZXJzLFxuICAgIGZpbHRlcjogRmlsdGVyRnVubmVsLFxuICAgIGludGVyYWN0aW9uOiBTZXR0aW5ncyxcbiAgICBtYXA6IEN1cnNvckNsaWNrXG4gIH07XG5cbiAgLy8gV2Ugc2hvdWxkIGRlZmluZWQgc2lkZWJhciBwYW5lbHMgaGVyZSBidXQga2VlcGluZyB0aGVtIGZvciBiYWNrd2FyZCBjb21wYXRpYmxlXG4gIGNvbnN0IGZ1bGxQYW5lbHMgPSBTSURFQkFSX1BBTkVMUy5tYXAoY29tcG9uZW50ID0+ICh7XG4gICAgLi4uY29tcG9uZW50LFxuICAgIGNvbXBvbmVudDogU0lERUJBUl9DT01QT05FTlRTW2NvbXBvbmVudC5pZF0sXG4gICAgaWNvbkNvbXBvbmVudDogU0lERUJBUl9JQ09OU1tjb21wb25lbnQuaWRdXG4gIH0pKTtcblxuICBjb25zdCBnZXRDdXN0b21QYW5lbFByb3BzID0gZ2V0KEN1c3RvbVBhbmVscywgWydkZWZhdWx0UHJvcHMnLCAnZ2V0UHJvcHMnXSkgfHwgKCgpID0+ICh7fSkpO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtc3RhdGVtZW50c1xuICBjb25zdCBTaWRlUGFuZWwgPSAocHJvcHM6IFNpZGVQYW5lbFByb3BzKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgYXBwTmFtZSxcbiAgICAgIGFwcFdlYnNpdGUsXG4gICAgICBhdmFpbGFibGVQcm92aWRlcnMsXG4gICAgICBkYXRhc2V0cyxcbiAgICAgIGZpbHRlcnMsXG4gICAgICBsYXllcnMsXG4gICAgICBsYXllckJsZW5kaW5nLFxuICAgICAgb3ZlcmxheUJsZW5kaW5nLFxuICAgICAgbGF5ZXJDbGFzc2VzLFxuICAgICAgbGF5ZXJPcmRlcixcbiAgICAgIGludGVyYWN0aW9uQ29uZmlnLFxuICAgICAgcGFuZWxzLFxuICAgICAgbWFwSW5mbyxcbiAgICAgIG1hcFNhdmVkLFxuICAgICAgbWFwU3RhdGVBY3Rpb25zLFxuICAgICAgbWFwU3R5bGUsXG4gICAgICBtYXBTdHlsZUFjdGlvbnMsXG4gICAgICBvblNhdmVNYXAsXG4gICAgICB1aVN0YXRlLFxuICAgICAgdWlTdGF0ZUFjdGlvbnMsXG4gICAgICB2aXNTdGF0ZUFjdGlvbnMsXG4gICAgICB2ZXJzaW9uLFxuICAgICAgd2lkdGhcbiAgICB9ID0gcHJvcHM7XG4gICAgY29uc3Qge29wZW5EZWxldGVNb2RhbCwgdG9nZ2xlTW9kYWwsIHRvZ2dsZVNpZGVQYW5lbH0gPSB1aVN0YXRlQWN0aW9ucztcbiAgICBjb25zdCB7YWN0aXZlU2lkZVBhbmVsfSA9IHVpU3RhdGU7XG4gICAgY29uc3Qge3NldE1hcEluZm8sIHNob3dEYXRhc2V0VGFibGUsIHVwZGF0ZVRhYmxlQ29sb3J9ID0gdmlzU3RhdGVBY3Rpb25zO1xuICAgIGNvbnN0IHtoYXNTaGFyZSwgaGFzU3RvcmFnZX0gPSBhdmFpbGFibGVQcm92aWRlcnM7XG5cbiAgICBjb25zdCB7dGl0bGV9ID0gbWFwSW5mbztcblxuICAgIGNvbnN0IGlzT3BlbiA9IEJvb2xlYW4oYWN0aXZlU2lkZVBhbmVsKTtcblxuICAgIGNvbnN0IF9vbk9wZW5PckNsb3NlID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlU2lkZVBhbmVsKGFjdGl2ZVNpZGVQYW5lbCA/ICcnIDogJ2xheWVyJyksIFtcbiAgICAgIGFjdGl2ZVNpZGVQYW5lbCxcbiAgICAgIHRvZ2dsZVNpZGVQYW5lbFxuICAgIF0pO1xuXG4gICAgY29uc3Qgb25DbGlja0V4cG9ydEltYWdlID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlTW9kYWwoRVhQT1JUX0lNQUdFX0lEKSwgW3RvZ2dsZU1vZGFsXSk7XG4gICAgY29uc3Qgb25DbGlja0V4cG9ydERhdGEgPSB1c2VDYWxsYmFjaygoKSA9PiB0b2dnbGVNb2RhbChFWFBPUlRfREFUQV9JRCksIFt0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uQ2xpY2tFeHBvcnRNYXAgPSB1c2VDYWxsYmFjaygoKSA9PiB0b2dnbGVNb2RhbChFWFBPUlRfTUFQX0lEKSwgW3RvZ2dsZU1vZGFsXSk7XG4gICAgY29uc3Qgb25DbGlja1NhdmVUb1N0b3JhZ2UgPSB1c2VDYWxsYmFjayhcbiAgICAgICgpID0+IHRvZ2dsZU1vZGFsKG1hcFNhdmVkID8gT1ZFUldSSVRFX01BUF9JRCA6IFNBVkVfTUFQX0lEKSxcbiAgICAgIFttYXBTYXZlZCwgdG9nZ2xlTW9kYWxdXG4gICAgKTtcbiAgICBjb25zdCBvbkNsaWNrU2F2ZUFzVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgc2V0TWFwSW5mbyh7XG4gICAgICAgIHRpdGxlOiBgJHt0aXRsZSB8fCAnS2VwbGVyLmdsJ30gKENvcHkpYFxuICAgICAgfSk7XG5cbiAgICAgIHRvZ2dsZU1vZGFsKFNBVkVfTUFQX0lEKTtcbiAgICB9LCBbdGl0bGUsIHNldE1hcEluZm8sIHRvZ2dsZU1vZGFsXSk7XG4gICAgY29uc3Qgb25DbGlja1NoYXJlTWFwID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlTW9kYWwoU0hBUkVfTUFQX0lEKSwgW3RvZ2dsZU1vZGFsXSk7XG4gICAgY29uc3Qgb25TaG93RGF0YXNldFRhYmxlID0gdXNlQ2FsbGJhY2soZGF0YUlkID0+IHNob3dEYXRhc2V0VGFibGUoZGF0YUlkKSwgW3Nob3dEYXRhc2V0VGFibGVdKTtcbiAgICBjb25zdCBvblVwZGF0ZVRhYmxlQ29sb3IgPSB1c2VDYWxsYmFjayhcbiAgICAgIChkYXRhSWQsIG5ld0NvbG9yKSA9PiB1cGRhdGVUYWJsZUNvbG9yKGRhdGFJZCwgbmV3Q29sb3IpLFxuICAgICAgW3VwZGF0ZVRhYmxlQ29sb3JdXG4gICAgKTtcbiAgICBjb25zdCBvblNob3dBZGREYXRhTW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiB0b2dnbGVNb2RhbChBRERfREFUQV9JRCksIFt0b2dnbGVNb2RhbF0pO1xuICAgIGNvbnN0IG9uU2hvd0FkZE1hcFN0eWxlTW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiB0b2dnbGVNb2RhbChBRERfTUFQX1NUWUxFX0lEKSwgW3RvZ2dsZU1vZGFsXSk7XG4gICAgY29uc3Qgb25SZW1vdmVEYXRhc2V0ID0gdXNlQ2FsbGJhY2soZGF0YUlkID0+IG9wZW5EZWxldGVNb2RhbChkYXRhSWQpLCBbb3BlbkRlbGV0ZU1vZGFsXSk7XG4gICAgY29uc3Qgb25TYXZlVG9TdG9yYWdlID0gdXNlTWVtbygoKSA9PiAoaGFzU3RvcmFnZSA/IG9uQ2xpY2tTYXZlVG9TdG9yYWdlIDogbnVsbCksIFtcbiAgICAgIGhhc1N0b3JhZ2UsXG4gICAgICBvbkNsaWNrU2F2ZVRvU3RvcmFnZVxuICAgIF0pO1xuICAgIGNvbnN0IG9uU2F2ZUFzVG9TdG9yYWdlID0gdXNlTWVtbyhcbiAgICAgICgpID0+IChoYXNTdG9yYWdlICYmIG1hcFNhdmVkID8gb25DbGlja1NhdmVBc1RvU3RvcmFnZSA6IG51bGwpLFxuICAgICAgW2hhc1N0b3JhZ2UsIG1hcFNhdmVkLCBvbkNsaWNrU2F2ZUFzVG9TdG9yYWdlXVxuICAgICk7XG4gICAgY29uc3QgY3VycmVudFBhbmVsID0gdXNlTWVtbygoKSA9PiBwYW5lbHMuZmluZCgoe2lkfSkgPT4gaWQgPT09IGFjdGl2ZVNpZGVQYW5lbCksIFtcbiAgICAgIGFjdGl2ZVNpZGVQYW5lbCxcbiAgICAgIHBhbmVsc1xuICAgIF0pO1xuICAgIGNvbnN0IG9uU2hhcmVNYXAgPSB1c2VNZW1vKCgpID0+IChoYXNTaGFyZSA/IG9uQ2xpY2tTaGFyZU1hcCA6IG51bGwpLCBbXG4gICAgICBoYXNTaGFyZSxcbiAgICAgIG9uQ2xpY2tTaGFyZU1hcFxuICAgIF0pO1xuICAgIGNvbnN0IGN1c3RvbVBhbmVsUHJvcHMgPSB1c2VNZW1vKCgpID0+IGdldEN1c3RvbVBhbmVsUHJvcHMocHJvcHMpLCBbcHJvcHNdKTtcblxuICAgIGNvbnN0IFBhbmVsQ29tcG9uZW50ID0gY3VycmVudFBhbmVsPy5jb21wb25lbnQ7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFNpZGViYXJcbiAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgc2hvdWxkU2hvd0NvbGxhcHNlQnV0dG9uPXt1aVN0YXRlLmlzU2lkZVBhbmVsQ2xvc2VCdXR0b25WaXNpYmxlfVxuICAgICAgICBtaW5pZmllZFdpZHRoPXswfVxuICAgICAgICBvbk9wZW5PckNsb3NlPXtfb25PcGVuT3JDbG9zZX1cbiAgICAgID5cbiAgICAgICAgPFBhbmVsSGVhZGVyXG4gICAgICAgICAgYXBwTmFtZT17YXBwTmFtZX1cbiAgICAgICAgICB2ZXJzaW9uPXt2ZXJzaW9ufVxuICAgICAgICAgIGFwcFdlYnNpdGU9e2FwcFdlYnNpdGV9XG4gICAgICAgICAgdmlzaWJsZURyb3Bkb3duPXt1aVN0YXRlLnZpc2libGVEcm9wZG93bn1cbiAgICAgICAgICBzaG93RXhwb3J0RHJvcGRvd249e3VpU3RhdGVBY3Rpb25zLnNob3dFeHBvcnREcm9wZG93bn1cbiAgICAgICAgICBoaWRlRXhwb3J0RHJvcGRvd249e3VpU3RhdGVBY3Rpb25zLmhpZGVFeHBvcnREcm9wZG93bn1cbiAgICAgICAgICBvbkV4cG9ydEltYWdlPXtvbkNsaWNrRXhwb3J0SW1hZ2V9XG4gICAgICAgICAgb25FeHBvcnREYXRhPXtvbkNsaWNrRXhwb3J0RGF0YX1cbiAgICAgICAgICBvbkV4cG9ydE1hcD17b25DbGlja0V4cG9ydE1hcH1cbiAgICAgICAgICBvblNhdmVNYXA9e29uU2F2ZU1hcH1cbiAgICAgICAgICBvblNhdmVUb1N0b3JhZ2U9e29uU2F2ZVRvU3RvcmFnZX1cbiAgICAgICAgICBvblNhdmVBc1RvU3RvcmFnZT17b25TYXZlQXNUb1N0b3JhZ2V9XG4gICAgICAgICAgb25TaGFyZU1hcD17b25TaGFyZU1hcH1cbiAgICAgICAgLz5cbiAgICAgICAgey8qIHRoZSBuZXh0IHR3byBjb21wb25lbnRzIHNob3VsZCBiZSBtb3ZlZCBpbnRvIG9uZSAqL31cbiAgICAgICAgey8qIGJ1dCBpIGFtIGtlZXBpbmcgdGhlbSBiZWNhdXNlIG9mIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKi99XG4gICAgICAgIDxQYW5lbFRvZ2dsZVxuICAgICAgICAgIHBhbmVscz17cGFuZWxzfVxuICAgICAgICAgIGFjdGl2ZVBhbmVsPXthY3RpdmVTaWRlUGFuZWx9XG4gICAgICAgICAgdG9nZ2xlUGFuZWw9e3VpU3RhdGVBY3Rpb25zLnRvZ2dsZVNpZGVQYW5lbH1cbiAgICAgICAgLz5cbiAgICAgICAgPFN0eWxlZFNpZGVQYW5lbENvbnRlbnQgY2xhc3NOYW1lPVwic2lkZS1wYW5lbF9fY29udGVudFwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic2lkZS1wYW5lbF9fY29udGVudF9faW5uZXJcIj5cbiAgICAgICAgICAgIHtQYW5lbENvbXBvbmVudCA/IChcbiAgICAgICAgICAgICAgPFBhbmVsQ29tcG9uZW50XG4gICAgICAgICAgICAgICAgZGF0YXNldHM9e2RhdGFzZXRzfVxuICAgICAgICAgICAgICAgIGZpbHRlcnM9e2ZpbHRlcnN9XG4gICAgICAgICAgICAgICAgbGF5ZXJzPXtsYXllcnN9XG4gICAgICAgICAgICAgICAgbGF5ZXJDbGFzc2VzPXtsYXllckNsYXNzZXN9XG4gICAgICAgICAgICAgICAgbGF5ZXJPcmRlcj17bGF5ZXJPcmRlcn1cbiAgICAgICAgICAgICAgICBsYXllckJsZW5kaW5nPXtsYXllckJsZW5kaW5nfVxuICAgICAgICAgICAgICAgIG92ZXJsYXlCbGVuZGluZz17b3ZlcmxheUJsZW5kaW5nfVxuICAgICAgICAgICAgICAgIG1hcFN0eWxlPXttYXBTdHlsZX1cbiAgICAgICAgICAgICAgICBtYXBTdHlsZUFjdGlvbnM9e21hcFN0eWxlQWN0aW9uc31cbiAgICAgICAgICAgICAgICBtYXBTdGF0ZUFjdGlvbnM9e21hcFN0YXRlQWN0aW9uc31cbiAgICAgICAgICAgICAgICBpbnRlcmFjdGlvbkNvbmZpZz17aW50ZXJhY3Rpb25Db25maWd9XG4gICAgICAgICAgICAgICAgcmVtb3ZlRGF0YXNldD17b25SZW1vdmVEYXRhc2V0fVxuICAgICAgICAgICAgICAgIHNob3dEYXRhc2V0VGFibGU9e29uU2hvd0RhdGFzZXRUYWJsZX1cbiAgICAgICAgICAgICAgICB1cGRhdGVUYWJsZUNvbG9yPXtvblVwZGF0ZVRhYmxlQ29sb3J9XG4gICAgICAgICAgICAgICAgc2hvd0FkZERhdGFNb2RhbD17b25TaG93QWRkRGF0YU1vZGFsfVxuICAgICAgICAgICAgICAgIHNob3dBZGRNYXBTdHlsZU1vZGFsPXtvblNob3dBZGRNYXBTdHlsZU1vZGFsfVxuICAgICAgICAgICAgICAgIHVpU3RhdGVBY3Rpb25zPXt1aVN0YXRlQWN0aW9uc31cbiAgICAgICAgICAgICAgICB2aXNTdGF0ZUFjdGlvbnM9e3Zpc1N0YXRlQWN0aW9uc31cbiAgICAgICAgICAgICAgICBwYW5lbE1ldGFkYXRhPXtjdXJyZW50UGFuZWx9XG4gICAgICAgICAgICAgICAgcGFuZWxMaXN0Vmlldz17XG4gICAgICAgICAgICAgICAgICBjdXJyZW50UGFuZWw/LmlkID09PSAnbGF5ZXInXG4gICAgICAgICAgICAgICAgICAgID8gdWlTdGF0ZS5sYXllclBhbmVsTGlzdFZpZXdcbiAgICAgICAgICAgICAgICAgICAgOiBjdXJyZW50UGFuZWw/LmlkID09PSAnZmlsdGVyJ1xuICAgICAgICAgICAgICAgICAgICA/IHVpU3RhdGUuZmlsdGVyUGFuZWxMaXN0Vmlld1xuICAgICAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgICAgIDxDdXN0b21QYW5lbHNcbiAgICAgICAgICAgICAgey4uLmN1c3RvbVBhbmVsUHJvcHN9XG4gICAgICAgICAgICAgIGFjdGl2ZVNpZGVQYW5lbD17YWN0aXZlU2lkZVBhbmVsfVxuICAgICAgICAgICAgICB1cGRhdGVUYWJsZUNvbG9yPXtvblVwZGF0ZVRhYmxlQ29sb3J9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L1N0eWxlZFNpZGVQYW5lbENvbnRlbnQ+XG4gICAgICA8L1NpZGViYXI+XG4gICAgKTtcbiAgfTtcblxuICBTaWRlUGFuZWwuZGVmYXVsdFByb3BzID0ge1xuICAgIHBhbmVsczogZnVsbFBhbmVscyxcbiAgICBzaWRlYmFyQ29tcG9uZW50czogU0lERUJBUl9DT01QT05FTlRTLFxuICAgIHVpU3RhdGU6IHt9LFxuICAgIHZpc1N0YXRlQWN0aW9uczoge30sXG4gICAgbWFwU3R5bGVBY3Rpb25zOiB7fSxcbiAgICB1aVN0YXRlQWN0aW9uczoge30sXG4gICAgYXZhaWxhYmxlUHJvdmlkZXJzOiB7fSxcbiAgICBtYXBJbmZvOiB7fVxuICB9O1xuXG4gIHJldHVybiBTaWRlUGFuZWw7XG59XG4iXX0=