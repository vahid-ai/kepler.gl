"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _d3Scale = require("d3-scale");

var _d3Array = require("d3-array");

var _d3Color = require("d3-color");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _templateObject;

var histogramStyle = {
  highlightW: 0.7,
  unHighlightedW: 0.4
};

var HistogramWrapper = _styledComponents["default"].svg(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  overflow: visible;\n"])));

var BarUnmemoized = _styledComponents["default"].rect(function (_ref) {
  var theme = _ref.theme,
      inRange = _ref.inRange,
      color = _ref.color;
  return "\n  ".concat(inRange ? "fill: ".concat(color !== null && color !== void 0 ? color : theme.histogramFillInRange, ";") : "fill: ".concat(color ? (0, _d3Color.hcl)(color).darker() : theme.histogramFillOutRange, ";"), "\n");
});

var Bar = /*#__PURE__*/_react["default"].memo(BarUnmemoized);

Bar.displayName = 'Bar';

function HistogramPlotFactory() {
  var HistogramPlot = function HistogramPlot(_ref2) {
    var width = _ref2.width,
        height = _ref2.height,
        margin = _ref2.margin,
        isRanged = _ref2.isRanged,
        histogram = _ref2.histogram,
        value = _ref2.value,
        brushComponent = _ref2.brushComponent;

    var undefinedToZero = function undefinedToZero(x) {
      return x ? x : 0;
    };

    var domain = (0, _react.useMemo)(function () {
      return [histogram[0].x0, histogram[histogram.length - 1].x1].map(function (item) {
        return undefinedToZero(item);
      });
    }, [histogram]);
    var dataId = Object.keys(histogram[0]).filter(function (k) {
      return k !== 'x0' && k !== 'x1';
    })[0]; // use 1st for now

    var getValue = (0, _react.useMemo)(function () {
      return function (d) {
        return d[dataId];
      };
    }, [dataId]);
    var x = (0, _react.useMemo)(function () {
      return (0, _d3Scale.scaleLinear)().domain(domain).range([0, width]);
    }, [domain, width]);
    var y = (0, _react.useMemo)(function () {
      return (0, _d3Scale.scaleLinear)().domain([0, Number((0, _d3Array.max)(histogram, getValue))]).range([0, height]);
    }, [histogram, height, getValue]);
    var barWidth = width / histogram.length;
    return /*#__PURE__*/_react["default"].createElement(HistogramWrapper, {
      width: width,
      height: height,
      style: {
        marginTop: "".concat(margin.top, "px")
      }
    }, /*#__PURE__*/_react["default"].createElement("g", {
      className: "histogram-bars"
    }, histogram.map(function (bar) {
      var inRange = undefinedToZero(bar.x1) <= value[1] && undefinedToZero(bar.x0) >= value[0];
      var wRatio = inRange ? histogramStyle.highlightW : histogramStyle.unHighlightedW;
      var startX = x(undefinedToZero(bar.x0)) + barWidth * (1 - wRatio) / 2;

      if (startX > 0 && startX + barWidth * histogramStyle.unHighlightedW <= width) {
        return /*#__PURE__*/_react["default"].createElement(Bar, {
          inRange: inRange,
          key: bar.x0,
          height: y(getValue(bar)),
          width: barWidth * wRatio,
          x: startX,
          rx: 1,
          ry: 1,
          y: height - y(getValue(bar))
        });
      }

      return null;
    })), /*#__PURE__*/_react["default"].createElement("g", {
      transform: "translate(".concat(isRanged ? 0 : barWidth / 2, ", 0)")
    }, brushComponent));
  };

  var EmpptyOrPlot = function EmpptyOrPlot(props) {
    return !props.histogram || !props.histogram.length ? null : /*#__PURE__*/_react["default"].createElement(HistogramPlot, props);
  };

  return EmpptyOrPlot;
}

var _default = HistogramPlotFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3NyYy9jb21tb24vaGlzdG9ncmFtLXBsb3QudHN4Il0sIm5hbWVzIjpbImhpc3RvZ3JhbVN0eWxlIiwiaGlnaGxpZ2h0VyIsInVuSGlnaGxpZ2h0ZWRXIiwiSGlzdG9ncmFtV3JhcHBlciIsInN0eWxlZCIsInN2ZyIsIkJhclVubWVtb2l6ZWQiLCJyZWN0IiwidGhlbWUiLCJpblJhbmdlIiwiY29sb3IiLCJoaXN0b2dyYW1GaWxsSW5SYW5nZSIsImRhcmtlciIsImhpc3RvZ3JhbUZpbGxPdXRSYW5nZSIsIkJhciIsIlJlYWN0IiwibWVtbyIsImRpc3BsYXlOYW1lIiwiSGlzdG9ncmFtUGxvdEZhY3RvcnkiLCJIaXN0b2dyYW1QbG90Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXJnaW4iLCJpc1JhbmdlZCIsImhpc3RvZ3JhbSIsInZhbHVlIiwiYnJ1c2hDb21wb25lbnQiLCJ1bmRlZmluZWRUb1plcm8iLCJ4IiwiZG9tYWluIiwieDAiLCJsZW5ndGgiLCJ4MSIsIm1hcCIsIml0ZW0iLCJkYXRhSWQiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwiayIsImdldFZhbHVlIiwiZCIsInJhbmdlIiwieSIsIk51bWJlciIsImJhcldpZHRoIiwibWFyZ2luVG9wIiwidG9wIiwiYmFyIiwid1JhdGlvIiwic3RhcnRYIiwiRW1wcHR5T3JQbG90IiwicHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFHQSxJQUFNQSxjQUFjLEdBQUc7QUFDckJDLEVBQUFBLFVBQVUsRUFBRSxHQURTO0FBRXJCQyxFQUFBQSxjQUFjLEVBQUU7QUFGSyxDQUF2Qjs7QUFLQSxJQUFNQyxnQkFBZ0IsR0FBR0MsNkJBQU9DLEdBQVYsOEdBQXRCOztBQU9BLElBQU1DLGFBQWEsR0FBR0YsNkJBQU9HLElBQVAsQ0FDcEI7QUFBQSxNQUFFQyxLQUFGLFFBQUVBLEtBQUY7QUFBQSxNQUFT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QUNELGFBQU8sSUFBUDtBQUNELEtBcEJBLENBREgsQ0FERixlQXdCRTtBQUFHLE1BQUEsU0FBUyxzQkFBZXpCLFFBQVEsR0FBRyxDQUFILEdBQU9zQixRQUFRLEdBQUcsQ0FBekM7QUFBWixPQUErRG5CLGNBQS9ELENBeEJGLENBREY7QUE0QkQsR0FsRUQ7O0FBb0VBLE1BQU15QixZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFBQyxLQUFLO0FBQUEsV0FDeEIsQ0FBQ0EsS0FBSyxDQUFDNUIsU0FBUCxJQUFvQixDQUFDNEIsS0FBSyxDQUFDNUIsU0FBTixDQUFnQk8sTUFBckMsR0FBOEMsSUFBOUMsZ0JBQXFELGdDQUFDLGFBQUQsRUFBbUJxQixLQUFuQixDQUQ3QjtBQUFBLEdBQTFCOztBQUdBLFNBQU9ELFlBQVA7QUFDRDs7ZUFDY2pDLG9CIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDIzIFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IFJlYWN0LCB7UmVhY3RFbGVtZW50LCB1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge3NjYWxlTGluZWFyfSBmcm9tICdkMy1zY2FsZSc7XG5pbXBvcnQge21heH0gZnJvbSAnZDMtYXJyYXknO1xuaW1wb3J0IHtoY2x9IGZyb20gJ2QzLWNvbG9yJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtIaXN0b2dyYW1CaW59IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuXG5jb25zdCBoaXN0b2dyYW1TdHlsZSA9IHtcbiAgaGlnaGxpZ2h0VzogMC43LFxuICB1bkhpZ2hsaWdodGVkVzogMC40XG59O1xuXG5jb25zdCBIaXN0b2dyYW1XcmFwcGVyID0gc3R5bGVkLnN2Z2BcbiAgb3ZlcmZsb3c6IHZpc2libGU7XG5gO1xuXG50eXBlIEJhclR5cGUgPSB7XG4gIGluUmFuZ2U6IGJvb2xlYW47XG59O1xuY29uc3QgQmFyVW5tZW1vaXplZCA9IHN0eWxlZC5yZWN0PEJhclR5cGU+KFxuICAoe3RoZW1lLCBpblJhbmdlLCBjb2xvcn0pID0+IGBcbiAgJHtcbiAgICBpblJhbmdlXG4gICAgICA/IGBmaWxsOiAke2NvbG9yID8/IHRoZW1lLmhpc3RvZ3JhbUZpbGxJblJhbmdlfTtgXG4gICAgICA6IGBmaWxsOiAke2NvbG9yID8gaGNsKGNvbG9yKS5kYXJrZXIoKSA6IHRoZW1lLmhpc3RvZ3JhbUZpbGxPdXRSYW5nZX07YFxuICB9XG5gXG4pO1xuY29uc3QgQmFyID0gUmVhY3QubWVtbyhCYXJVbm1lbW9pemVkKTtcbkJhci5kaXNwbGF5TmFtZSA9ICdCYXInO1xuXG5pbnRlcmZhY2UgSGlzdG9ncmFtUGxvdFByb3BzIHtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIG1hcmdpbjoge3RvcDogbnVtYmVyOyBib3R0b206IG51bWJlcjsgbGVmdDogbnVtYmVyOyByaWdodDogbnVtYmVyfTtcbiAgaXNSYW5nZWQ/OiBib29sZWFuO1xuICBoaXN0b2dyYW06IEhpc3RvZ3JhbUJpbltdO1xuICB2YWx1ZTogbnVtYmVyW107XG4gIGJydXNoQ29tcG9uZW50PzogUmVhY3RFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBIaXN0b2dyYW1QbG90RmFjdG9yeSgpIHtcbiAgY29uc3QgSGlzdG9ncmFtUGxvdCA9ICh7XG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0LFxuICAgIG1hcmdpbixcbiAgICBpc1JhbmdlZCxcbiAgICBoaXN0b2dyYW0sXG4gICAgdmFsdWUsXG4gICAgYnJ1c2hDb21wb25lbnRcbiAgfTogSGlzdG9ncmFtUGxvdFByb3BzKSA9PiB7XG4gICAgY29uc3QgdW5kZWZpbmVkVG9aZXJvID0gKHg6IG51bWJlciB8IHVuZGVmaW5lZCkgPT4gKHggPyB4IDogMCk7XG4gICAgY29uc3QgZG9tYWluID0gdXNlTWVtbyhcbiAgICAgICgpID0+XG4gICAgICAgIFtoaXN0b2dyYW1bMF0ueDAsIGhpc3RvZ3JhbVtoaXN0b2dyYW0ubGVuZ3RoIC0gMV0ueDFdLm1hcChpdGVtID0+IHVuZGVmaW5lZFRvWmVybyhpdGVtKSksXG4gICAgICBbaGlzdG9ncmFtXVxuICAgICk7XG4gICAgY29uc3QgZGF0YUlkID0gT2JqZWN0LmtleXMoaGlzdG9ncmFtWzBdKS5maWx0ZXIoayA9PiBrICE9PSAneDAnICYmIGsgIT09ICd4MScpWzBdO1xuXG4gICAgLy8gdXNlIDFzdCBmb3Igbm93XG4gICAgY29uc3QgZ2V0VmFsdWUgPSB1c2VNZW1vKCgpID0+IGQgPT4gZFtkYXRhSWRdLCBbZGF0YUlkXSk7XG5cbiAgICBjb25zdCB4ID0gdXNlTWVtbyhcbiAgICAgICgpID0+XG4gICAgICAgIHNjYWxlTGluZWFyKClcbiAgICAgICAgICAuZG9tYWluKGRvbWFpbilcbiAgICAgICAgICAucmFuZ2UoWzAsIHdpZHRoXSksXG4gICAgICBbZG9tYWluLCB3aWR0aF1cbiAgICApO1xuXG4gICAgY29uc3QgeSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PlxuICAgICAgICBzY2FsZUxpbmVhcigpXG4gICAgICAgICAgLmRvbWFpbihbMCwgTnVtYmVyKG1heChoaXN0b2dyYW0sIGdldFZhbHVlKSldKVxuICAgICAgICAgIC5yYW5nZShbMCwgaGVpZ2h0XSksXG4gICAgICBbaGlzdG9ncmFtLCBoZWlnaHQsIGdldFZhbHVlXVxuICAgICk7XG5cbiAgICBjb25zdCBiYXJXaWR0aCA9IHdpZHRoIC8gaGlzdG9ncmFtLmxlbmd0aDtcblxuICAgIHJldHVybiAoXG4gICAgICA8SGlzdG9ncmFtV3JhcHBlciB3aWR0aD17d2lkdGh9IGhlaWdodD17aGVpZ2h0fSBzdHlsZT17e21hcmdpblRvcDogYCR7bWFyZ2luLnRvcH1weGB9fT5cbiAgICAgICAgPGcgY2xhc3NOYW1lPVwiaGlzdG9ncmFtLWJhcnNcIj5cbiAgICAgICAgICB7aGlzdG9ncmFtLm1hcChiYXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5SYW5nZSA9XG4gICAgICAgICAgICAgIHVuZGVmaW5lZFRvWmVybyhiYXIueDEpIDw9IHZhbHVlWzFdICYmIHVuZGVmaW5lZFRvWmVybyhiYXIueDApID49IHZhbHVlWzBdO1xuICAgICAgICAgICAgY29uc3Qgd1JhdGlvID0gaW5SYW5nZSA/IGhpc3RvZ3JhbVN0eWxlLmhpZ2hsaWdodFcgOiBoaXN0b2dyYW1TdHlsZS51bkhpZ2hsaWdodGVkVztcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHgodW5kZWZpbmVkVG9aZXJvKGJhci54MCkpICsgKGJhcldpZHRoICogKDEgLSB3UmF0aW8pKSAvIDI7XG4gICAgICAgICAgICBpZiAoc3RhcnRYID4gMCAmJiBzdGFydFggKyBiYXJXaWR0aCAqIGhpc3RvZ3JhbVN0eWxlLnVuSGlnaGxpZ2h0ZWRXIDw9IHdpZHRoKSB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEJhclxuICAgICAgICAgICAgICAgICAgaW5SYW5nZT17aW5SYW5nZX1cbiAgICAgICAgICAgICAgICAgIGtleT17YmFyLngwfVxuICAgICAgICAgICAgICAgICAgaGVpZ2h0PXt5KGdldFZhbHVlKGJhcikpfVxuICAgICAgICAgICAgICAgICAgd2lkdGg9e2JhcldpZHRoICogd1JhdGlvfVxuICAgICAgICAgICAgICAgICAgeD17c3RhcnRYfVxuICAgICAgICAgICAgICAgICAgcng9ezF9XG4gICAgICAgICAgICAgICAgICByeT17MX1cbiAgICAgICAgICAgICAgICAgIHk9e2hlaWdodCAtIHkoZ2V0VmFsdWUoYmFyKSl9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pfVxuICAgICAgICA8L2c+XG4gICAgICAgIDxnIHRyYW5zZm9ybT17YHRyYW5zbGF0ZSgke2lzUmFuZ2VkID8gMCA6IGJhcldpZHRoIC8gMn0sIDApYH0+e2JydXNoQ29tcG9uZW50fTwvZz5cbiAgICAgIDwvSGlzdG9ncmFtV3JhcHBlcj5cbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IEVtcHB0eU9yUGxvdCA9IHByb3BzID0+XG4gICAgIXByb3BzLmhpc3RvZ3JhbSB8fCAhcHJvcHMuaGlzdG9ncmFtLmxlbmd0aCA/IG51bGwgOiA8SGlzdG9ncmFtUGxvdCB7Li4ucHJvcHN9IC8+O1xuXG4gIHJldHVybiBFbXBwdHlPclBsb3Q7XG59XG5leHBvcnQgZGVmYXVsdCBIaXN0b2dyYW1QbG90RmFjdG9yeTtcbiJdfQ==