"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _classnames = _interopRequireDefault(require("classnames"));

var _icons = require("../icons");

var _constants = require("@kepler.gl/constants");

var _animationSpeedSlider = _interopRequireDefault(require("./animation-speed-slider"));

var _windowActionControl = _interopRequireDefault(require("./window-action-control"));

var _animationWindowControl = _interopRequireDefault(require("./animation-window-control"));

var _resetControl = _interopRequireDefault(require("./reset-control"));

var _playControl = _interopRequireDefault(require("./play-control"));

var _speedControl = _interopRequireDefault(require("./speed-control"));

var _templateObject, _DEFAULT_ANIMATE_ITEM;

var DEFAULT_BUTTON_HEIGHT = '20px';

var StyledAnimationControls = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n  width: ", "px;\n  &.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n  }\n"])), function (props) {
  return props.width;
});

var DEFAULT_ICONS = {
  /* eslint-disable react/display-name */
  reset: function reset(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Reset, {
      height: "18px"
    });
  },
  play: function play(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Play, {
      height: "18px"
    });
  },
  pause: function pause(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Pause, {
      height: "18px"
    });
  },
  "export": function _export(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Save, {
      height: "18px"
    });
  },

  /* eslint-enable react/display-name */
  speed: _icons.Rocket,
  animationFree: _icons.FreeWindow,
  animationIncremental: _icons.AnchorWindow
};

function nop() {}

var DEFAULT_ANIMATE_ITEMS = (_DEFAULT_ANIMATE_ITEM = {}, (0, _defineProperty2["default"])(_DEFAULT_ANIMATE_ITEM, _constants.ANIMATION_WINDOW.free, {
  id: _constants.ANIMATION_WINDOW.free,
  icon: DEFAULT_ICONS.animationFree,
  tooltip: 'tooltip.animationByWindow'
}), (0, _defineProperty2["default"])(_DEFAULT_ANIMATE_ITEM, _constants.ANIMATION_WINDOW.incremental, {
  id: _constants.ANIMATION_WINDOW.incremental,
  icon: DEFAULT_ICONS.animationIncremental,
  tooltip: 'tooltip.animationByIncremental'
}), _DEFAULT_ANIMATE_ITEM);
PlaybackControlsFactory.deps = [// keeping this for backwards compatibility but we can decide to drop it later
_animationSpeedSlider["default"], _windowActionControl["default"], _animationWindowControl["default"], _resetControl["default"], _playControl["default"]];

function PlaybackControlsFactory(AnimationSpeedSlider, WindowActionControl, AnimationWindowControl, ResetControl, PlayControl) {
  var PLAYBACK_CONTROLS_DEFAULT_ACTION_COMPONENTS = [PlayControl, (0, _speedControl["default"])(AnimationSpeedSlider), ResetControl, WindowActionControl, AnimationWindowControl]; // eslint-disable-next-line complexity

  var PlaybackControls = function PlaybackControls(_ref) {
    var isAnimatable = _ref.isAnimatable,
        isAnimating = _ref.isAnimating,
        width = _ref.width,
        speed = _ref.speed,
        animationWindow = _ref.animationWindow,
        setFilterAnimationWindow = _ref.setFilterAnimationWindow,
        updateAnimationSpeed = _ref.updateAnimationSpeed,
        pauseAnimation = _ref.pauseAnimation,
        resetAnimation = _ref.resetAnimation,
        startAnimation = _ref.startAnimation,
        playbackIcons = _ref.playbackIcons,
        animationItems = _ref.animationItems,
        buttonStyle = _ref.buttonStyle,
        buttonHeight = _ref.buttonHeight,
        _ref$playbackActionIt = _ref.playbackActionItems,
        playbackActionItems = _ref$playbackActionIt === void 0 ? [] : _ref$playbackActionIt;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        isSpeedControlVisible = _useState2[0],
        toggleSpeedControl = _useState2[1];

    var _useState3 = (0, _react.useState)(false),
        _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
        showAnimationWindowControl = _useState4[0],
        setShowAnimationWindowControl = _useState4[1];

    var toggleAnimationWindowControl = (0, _react.useCallback)(function () {
      setShowAnimationWindowControl(!showAnimationWindowControl);
    }, [showAnimationWindowControl, setShowAnimationWindowControl]);
    var btnStyle = buttonStyle ? (0, _defineProperty2["default"])({}, buttonStyle, true) : {};
    var hideAndShowSpeedControl = (0, _react.useCallback)(function () {
      if (!isSpeedControlVisible) {
        toggleSpeedControl(true);
      } else {
        // TODO: A HACK to allow input onblur get triggered before the input is unmounted
        // A better solution should be invested, see https://github.com/facebook/react/issues/12363
        window.setTimeout(function () {
          return toggleSpeedControl(false);
        }, 200);
      }
    }, [isSpeedControlVisible, toggleSpeedControl]);
    return /*#__PURE__*/_react["default"].createElement(StyledAnimationControls, {
      className: (0, _classnames["default"])('playback-controls', {
        disabled: !isAnimatable
      }),
      width: width
    }, playbackActionItems.map(function (ActionComponent, index) {
      return /*#__PURE__*/_react["default"].createElement(ActionComponent, {
        key: index,
        toggleAnimationWindowControl: toggleAnimationWindowControl,
        showAnimationWindowControl: showAnimationWindowControl,
        btnStyle: btnStyle,
        hideAndShowSpeedControl: hideAndShowSpeedControl,
        animationItems: animationItems,
        animationWindow: animationWindow,
        buttonHeight: buttonHeight,
        setFilterAnimationWindow: setFilterAnimationWindow,
        updateAnimationSpeed: updateAnimationSpeed,
        isAnimating: isAnimating,
        pauseAnimation: pauseAnimation,
        resetAnimation: resetAnimation,
        startAnimation: startAnimation,
        playbackIcons: playbackIcons,
        isSpeedControlVisible: isSpeedControlVisible,
        speed: speed
      });
    }));
  };

  PlaybackControls.defaultProps = {
    playbackIcons: DEFAULT_ICONS,
    animationItems: DEFAULT_ANIMATE_ITEMS,
    buttonStyle: 'secondary',
    buttonHeight: DEFAULT_BUTTON_HEIGHT,
    playbackActionItems: PLAYBACK_CONTROLS_DEFAULT_ACTION_COMPONENTS,
    animationWindow: _constants.ANIMATION_WINDOW.free,
    isAnimatable: true,
    pauseAnimation: nop,
    resetAnimation: nop,
    startAnimation: nop
  };
  return PlaybackControls;
}

var _default = PlaybackControlsFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3NyYy9jb21tb24vYW5pbWF0aW9uLWNvbnRyb2wvcGxheWJhY2stY29udHJvbHMudHN4Il0sIm5hbWVzIjpbIkRFRkFVTFRfQlVUVE9OX0hFSUdIVCIsIlN0eWxlZEFuaW1hdGlvbkNvbnRyb2xzIiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ3aWR0aCIsIkRFRkFVTFRfSUNPTlMiLCJyZXNldCIsIl8iLCJwbGF5IiwicGF1c2UiLCJzcGVlZCIsIlJvY2tldCIsImFuaW1hdGlvbkZyZWUiLCJGcmVlV2luZG93IiwiYW5pbWF0aW9uSW5jcmVtZW50YWwiLCJBbmNob3JXaW5kb3ciLCJub3AiLCJERUZBVUxUX0FOSU1BVEVfSVRFTVMiLCJBTklNQVRJT05fV0lORE9XIiwiZnJlZSIsImlkIiwiaWNvbiIsInRvb2x0aXAiLCJpbmNyZW1lbnRhbCIsIlBsYXliYWNrQ29udHJvbHNGYWN0b3J5IiwiZGVwcyIsIkFuaW1hdGlvblNwZWVkU2xpZGVyRmFjdG9yeSIsIldpbmRvd0FjdGlvbkNvbnRyb2xGYWN0b3J5IiwiQW5pbWF0aW9uV2luZG93Q29udHJvbEZhY3RvcnkiLCJSZXNldENvbnRyb2xGYWN0b3J5IiwiUGxheUNvbnRyb2xGYWN0b3J5IiwiQW5pbWF0aW9uU3BlZWRTbGlkZXIiLCJXaW5kb3dBY3Rpb25Db250cm9sIiwiQW5pbWF0aW9uV2luZG93Q29udHJvbCIsIlJlc2V0Q29udHJvbCIsIlBsYXlDb250cm9sIiwiUExBWUJBQ0tfQ09OVFJPTFNfREVGQVVMVF9BQ1RJT05fQ09NUE9ORU5UUyIsIlBsYXliYWNrQ29udHJvbHMiLCJpc0FuaW1hdGFibGUiLCJpc0FuaW1hdGluZyIsImFuaW1hdGlvbldpbmRvdyIsInNldEZpbHRlckFuaW1hdGlvbldpbmRvdyIsInVwZGF0ZUFuaW1hdGlvblNwZWVkIiwicGF1c2VBbmltYXRpb24iLCJyZXNldEFuaW1hdGlvbiIsInN0YXJ0QW5pbWF0aW9uIiwicGxheWJhY2tJY29ucyIsImFuaW1hdGlvbkl0ZW1zIiwiYnV0dG9uU3R5bGUiLCJidXR0b25IZWlnaHQiLCJwbGF5YmFja0FjdGlvbkl0ZW1zIiwiaXNTcGVlZENvbnRyb2xWaXNpYmxlIiwidG9nZ2xlU3BlZWRDb250cm9sIiwic2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2wiLCJzZXRTaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCIsInRvZ2dsZUFuaW1hdGlvbldpbmRvd0NvbnRyb2wiLCJidG5TdHlsZSIsImhpZGVBbmRTaG93U3BlZWRDb250cm9sIiwid2luZG93Iiwic2V0VGltZW91dCIsImRpc2FibGVkIiwibWFwIiwiQWN0aW9uQ29tcG9uZW50IiwiaW5kZXgiLCJkZWZhdWx0UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsSUFBTUEscUJBQXFCLEdBQUcsTUFBOUI7O0FBTUEsSUFBTUMsdUJBQXVCLEdBQUdDLDZCQUFPQyxHQUFWLHVOQUdsQixVQUFBQyxLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDQyxLQUFWO0FBQUEsQ0FIYSxDQUE3Qjs7QUFVQSxJQUFNQyxhQUFhLEdBQUc7QUFDcEI7QUFDQUMsRUFBQUEsS0FBSyxFQUFFLGVBQUFDLENBQUM7QUFBQSx3QkFBSSxnQ0FBQyxZQUFEO0FBQU8sTUFBQSxNQUFNLEVBQUM7QUFBZCxNQUFKO0FBQUEsR0FGWTtBQUdwQkMsRUFBQUEsSUFBSSxFQUFFLGNBQUFELENBQUM7QUFBQSx3QkFBSSxnQ0FBQyxXQUFEO0FBQU0sTUFBQSxNQUFNLEVBQUM7QUFBYixNQUFKO0FBQUEsR0FIYTtBQUlwQkUsRUFBQUEsS0FBSyxFQUFFLGVBQUFGLENBQUM7QUFBQSx3QkFBSSxnQ0FBQyxZQUFEO0FBQU8sTUFBQSxNQUFNLEVBQUM7QUFBZCxNQUFKO0FBQUEsR0FKWTtBQUtwQixZQUFRLGlCQUFBQSxDQUFDO0FBQUEs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OUIwQyxJQUFBQSxjQUFjLEVBQUU5QixxQkFGYztBQUc5QitCLElBQUFBLFdBQVcsRUFBRSxXQUhpQjtBQUk5QkMsSUFBQUEsWUFBWSxFQUFFbEQscUJBSmdCO0FBSzlCbUQsSUFBQUEsbUJBQW1CLEVBQUVkLDJDQUxTO0FBTTlCSSxJQUFBQSxlQUFlLEVBQUV0Qiw0QkFBaUJDLElBTko7QUFPOUJtQixJQUFBQSxZQUFZLEVBQUUsSUFQZ0I7QUFROUJLLElBQUFBLGNBQWMsRUFBRTNCLEdBUmM7QUFTOUI0QixJQUFBQSxjQUFjLEVBQUU1QixHQVRjO0FBVTlCNkIsSUFBQUEsY0FBYyxFQUFFN0I7QUFWYyxHQUFoQztBQWFBLFNBQU9xQixnQkFBUDtBQUNEOztlQUVjYix1QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMyBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbmltcG9ydCBSZWFjdCwge3VzZVN0YXRlLCB1c2VDYWxsYmFja30gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB7UmVzZXQsIFBsYXksIFBhdXNlLCBTYXZlLCBSb2NrZXQsIEFuY2hvcldpbmRvdywgRnJlZVdpbmRvd30gZnJvbSAnLi4vaWNvbnMnO1xuaW1wb3J0IHtBTklNQVRJT05fV0lORE9XfSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5pbXBvcnQgQW5pbWF0aW9uU3BlZWRTbGlkZXJGYWN0b3J5IGZyb20gJy4vYW5pbWF0aW9uLXNwZWVkLXNsaWRlcic7XG5pbXBvcnQgV2luZG93QWN0aW9uQ29udHJvbEZhY3RvcnkgZnJvbSAnLi93aW5kb3ctYWN0aW9uLWNvbnRyb2wnO1xuaW1wb3J0IEFuaW1hdGlvbldpbmRvd0NvbnRyb2xGYWN0b3J5LCB7QW5pbWF0aW9uSXRlbX0gZnJvbSAnLi9hbmltYXRpb24td2luZG93LWNvbnRyb2wnO1xuaW1wb3J0IFJlc2V0Q29udHJvbEZhY3RvcnkgZnJvbSAnLi9yZXNldC1jb250cm9sJztcbmltcG9ydCBQbGF5Q29udHJvbEZhY3RvcnkgZnJvbSAnLi9wbGF5LWNvbnRyb2wnO1xuaW1wb3J0IFNwZWVkQ29udHJvbEZhY3RvcnkgZnJvbSAnLi9zcGVlZC1jb250cm9sJztcblxuY29uc3QgREVGQVVMVF9CVVRUT05fSEVJR0hUID0gJzIwcHgnO1xuXG5pbnRlcmZhY2UgU3R5bGVkQW5pbWF0aW9uQ29udHJvbHNQcm9wcyB7XG4gIHdpZHRoPzogbnVtYmVyO1xufVxuXG5jb25zdCBTdHlsZWRBbmltYXRpb25Db250cm9scyA9IHN0eWxlZC5kaXY8U3R5bGVkQW5pbWF0aW9uQ29udHJvbHNQcm9wcz5gXG4gIGRpc3BsYXk6IGZsZXg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gcHJvcHMud2lkdGh9cHg7XG4gICYuZGlzYWJsZWQge1xuICAgIG9wYWNpdHk6IDAuNDtcbiAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgfVxuYDtcblxuY29uc3QgREVGQVVMVF9JQ09OUyA9IHtcbiAgLyogZXNsaW50LWRpc2FibGUgcmVhY3QvZGlzcGxheS1uYW1lICovXG4gIHJlc2V0OiBfID0+IDxSZXNldCBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIHBsYXk6IF8gPT4gPFBsYXkgaGVpZ2h0PVwiMThweFwiIC8+LFxuICBwYXVzZTogXyA9PiA8UGF1c2UgaGVpZ2h0PVwiMThweFwiIC8+LFxuICBleHBvcnQ6IF8gPT4gPFNhdmUgaGVpZ2h0PVwiMThweFwiIC8+LFxuICAvKiBlc2xpbnQtZW5hYmxlIHJlYWN0L2Rpc3BsYXktbmFtZSAqL1xuICBzcGVlZDogUm9ja2V0LFxuICBhbmltYXRpb25GcmVlOiBGcmVlV2luZG93LFxuICBhbmltYXRpb25JbmNyZW1lbnRhbDogQW5jaG9yV2luZG93XG59O1xuXG5mdW5jdGlvbiBub3AoKSB7fVxuXG5jb25zdCBERUZBVUxUX0FOSU1BVEVfSVRFTVMgPSB7XG4gIFtBTklNQVRJT05fV0lORE9XLmZyZWVdOiB7XG4gICAgaWQ6IEFOSU1BVElPTl9XSU5ET1cuZnJlZSxcbiAgICBpY29uOiBERUZBVUxUX0lDT05TLmFuaW1hdGlvbkZyZWUsXG4gICAgdG9vbHRpcDogJ3Rvb2x0aXAuYW5pbWF0aW9uQnlXaW5kb3cnXG4gIH0sXG4gIFtBTklNQVRJT05fV0lORE9XLmluY3JlbWVudGFsXToge1xuICAgIGlkOiBBTklNQVRJT05fV0lORE9XLmluY3JlbWVudGFsLFxuICAgIGljb246IERFRkFVTFRfSUNPTlMuYW5pbWF0aW9uSW5jcmVtZW50YWwsXG4gICAgdG9vbHRpcDogJ3Rvb2x0aXAuYW5pbWF0aW9uQnlJbmNyZW1lbnRhbCdcbiAgfVxufTtcbmludGVyZmFjZSBQbGF5YmFja0NvbnRyb2xzUHJvcHMge1xuICBpc0FuaW1hdGFibGU/OiBib29sZWFuO1xuICBpc0FuaW1hdGluZz86IGJvb2xlYW47XG4gIHdpZHRoPzogbnVtYmVyO1xuICBzcGVlZDogbnVtYmVyO1xuICBhbmltYXRpb25XaW5kb3c/OiBzdHJpbmc7XG4gIHNldEZpbHRlckFuaW1hdGlvbldpbmRvdz86IChpZDogc3RyaW5nKSA9PiB2b2lkO1xuICB1cGRhdGVBbmltYXRpb25TcGVlZD86ICh2YWw6IG51bWJlcikgPT4gdm9pZDtcbiAgcGF1c2VBbmltYXRpb24/OiAoKSA9PiB2b2lkO1xuICByZXNldEFuaW1hdGlvbj86ICgpID0+IHZvaWQ7XG4gIHN0YXJ0QW5pbWF0aW9uOiAoKSA9PiB2b2lkO1xuICBwbGF5YmFja0ljb25zPzogdHlwZW9mIERFRkFVTFRfSUNPTlM7XG4gIGFuaW1hdGlvbkl0ZW1zPzoge1trZXk6IHN0cmluZ106IEFuaW1hdGlvbkl0ZW19O1xuICBidXR0b25TdHlsZT86IHN0cmluZztcbiAgYnV0dG9uSGVpZ2h0Pzogc3RyaW5nO1xuICBwbGF5YmFja0FjdGlvbkl0ZW1zPzogYW55W107XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbn1cblxuUGxheWJhY2tDb250cm9sc0ZhY3RvcnkuZGVwcyA9IFtcbiAgLy8ga2VlcGluZyB0aGlzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBidXQgd2UgY2FuIGRlY2lkZSB0byBkcm9wIGl0IGxhdGVyXG4gIEFuaW1hdGlvblNwZWVkU2xpZGVyRmFjdG9yeSxcbiAgV2luZG93QWN0aW9uQ29udHJvbEZhY3RvcnksXG4gIEFuaW1hdGlvbldpbmRvd0NvbnRyb2xGYWN0b3J5LFxuICBSZXNldENvbnRyb2xGYWN0b3J5LFxuICBQbGF5Q29udHJvbEZhY3Rvcnlcbl07XG5cbmZ1bmN0aW9uIFBsYXliYWNrQ29udHJvbHNGYWN0b3J5KFxuICBBbmltYXRpb25TcGVlZFNsaWRlcjogUmV0dXJuVHlwZTx0eXBlb2YgQW5pbWF0aW9uU3BlZWRTbGlkZXJGYWN0b3J5PixcbiAgV2luZG93QWN0aW9uQ29udHJvbCxcbiAgQW5pbWF0aW9uV2luZG93Q29udHJvbCxcbiAgUmVzZXRDb250cm9sLFxuICBQbGF5Q29udHJvbFxuKSB7XG4gIGNvbnN0IFBMQVlCQUNLX0NPTlRST0xTX0RFRkFVTFRfQUNUSU9OX0NPTVBPTkVOVFMgPSBbXG4gICAgUGxheUNvbnRyb2wsXG4gICAgU3BlZWRDb250cm9sRmFjdG9yeShBbmltYXRpb25TcGVlZFNsaWRlciksXG4gICAgUmVzZXRDb250cm9sLFxuICAgIFdpbmRvd0FjdGlvbkNvbnRyb2wsXG4gICAgQW5pbWF0aW9uV2luZG93Q29udHJvbFxuICBdO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5XG4gIGNvbnN0IFBsYXliYWNrQ29udHJvbHM6IFJlYWN0LkZDPFBsYXliYWNrQ29udHJvbHNQcm9wcz4gPSAoe1xuICAgIGlzQW5pbWF0YWJsZSxcbiAgICBpc0FuaW1hdGluZyxcbiAgICB3aWR0aCxcbiAgICBzcGVlZCxcbiAgICBhbmltYXRpb25XaW5kb3csXG4gICAgc2V0RmlsdGVyQW5pbWF0aW9uV2luZG93LFxuICAgIHVwZGF0ZUFuaW1hdGlvblNwZWVkLFxuICAgIHBhdXNlQW5pbWF0aW9uLFxuICAgIHJlc2V0QW5pbWF0aW9uLFxuICAgIHN0YXJ0QW5pbWF0aW9uLFxuICAgIHBsYXliYWNrSWNvbnMsXG4gICAgYW5pbWF0aW9uSXRlbXMsXG4gICAgYnV0dG9uU3R5bGUsXG4gICAgYnV0dG9uSGVpZ2h0LFxuICAgIHBsYXliYWNrQWN0aW9uSXRlbXMgPSBbXVxuICB9KSA9PiB7XG4gICAgY29uc3QgW2lzU3BlZWRDb250cm9sVmlzaWJsZSwgdG9nZ2xlU3BlZWRDb250cm9sXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbc2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2wsIHNldFNob3dBbmltYXRpb25XaW5kb3dDb250cm9sXSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICAgIGNvbnN0IHRvZ2dsZUFuaW1hdGlvbldpbmRvd0NvbnRyb2wgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBzZXRTaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCghc2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2wpO1xuICAgIH0sIFtzaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCwgc2V0U2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2xdKTtcbiAgICBjb25zdCBidG5TdHlsZSA9IGJ1dHRvblN0eWxlID8ge1tidXR0b25TdHlsZV06IHRydWV9IDoge307XG5cbiAgICBjb25zdCBoaWRlQW5kU2hvd1NwZWVkQ29udHJvbCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmICghaXNTcGVlZENvbnRyb2xWaXNpYmxlKSB7XG4gICAgICAgIHRvZ2dsZVNwZWVkQ29udHJvbCh0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRPRE86IEEgSEFDSyB0byBhbGxvdyBpbnB1dCBvbmJsdXIgZ2V0IHRyaWdnZXJlZCBiZWZvcmUgdGhlIGlucHV0IGlzIHVubW91bnRlZFxuICAgICAgICAvLyBBIGJldHRlciBzb2x1dGlvbiBzaG91bGQgYmUgaW52ZXN0ZWQsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QvaXNzdWVzLzEyMzYzXG4gICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHRvZ2dsZVNwZWVkQ29udHJvbChmYWxzZSksIDIwMCk7XG4gICAgICB9XG4gICAgfSwgW2lzU3BlZWRDb250cm9sVmlzaWJsZSwgdG9nZ2xlU3BlZWRDb250cm9sXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFN0eWxlZEFuaW1hdGlvbkNvbnRyb2xzXG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NuYW1lcygncGxheWJhY2stY29udHJvbHMnLCB7XG4gICAgICAgICAgZGlzYWJsZWQ6ICFpc0FuaW1hdGFibGVcbiAgICAgICAgfSl9XG4gICAgICAgIHdpZHRoPXt3aWR0aH1cbiAgICAgID5cbiAgICAgICAgey8qKiBXaW5kb3cgKi99XG4gICAgICAgIHtwbGF5YmFja0FjdGlvbkl0ZW1zLm1hcCgoQWN0aW9uQ29tcG9uZW50LCBpbmRleCkgPT4gKFxuICAgICAgICAgIDxBY3Rpb25Db21wb25lbnRcbiAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICB0b2dnbGVBbmltYXRpb25XaW5kb3dDb250cm9sPXt0b2dnbGVBbmltYXRpb25XaW5kb3dDb250cm9sfVxuICAgICAgICAgICAgc2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2w9e3Nob3dBbmltYXRpb25XaW5kb3dDb250cm9sfVxuICAgICAgICAgICAgYnRuU3R5bGU9e2J0blN0eWxlfVxuICAgICAgICAgICAgaGlkZUFuZFNob3dTcGVlZENvbnRyb2w9e2hpZGVBbmRTaG93U3BlZWRDb250cm9sfVxuICAgICAgICAgICAgYW5pbWF0aW9uSXRlbXM9e2FuaW1hdGlvbkl0ZW1zfVxuICAgICAgICAgICAgYW5pbWF0aW9uV2luZG93PXthbmltYXRpb25XaW5kb3d9XG4gICAgICAgICAgICBidXR0b25IZWlnaHQ9e2J1dHRvbkhlaWdodH1cbiAgICAgICAgICAgIHNldEZpbHRlckFuaW1hdGlvbldpbmRvdz17c2V0RmlsdGVyQW5pbWF0aW9uV2luZG93fVxuICAgICAgICAgICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQ9e3VwZGF0ZUFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgICAgaXNBbmltYXRpbmc9e2lzQW5pbWF0aW5nfVxuICAgICAgICAgICAgcGF1c2VBbmltYXRpb249e3BhdXNlQW5pbWF0aW9ufVxuICAgICAgICAgICAgcmVzZXRBbmltYXRpb249e3Jlc2V0QW5pbWF0aW9ufVxuICAgICAgICAgICAgc3RhcnRBbmltYXRpb249e3N0YXJ0QW5pbWF0aW9ufVxuICAgICAgICAgICAgcGxheWJhY2tJY29ucz17cGxheWJhY2tJY29uc31cbiAgICAgICAgICAgIGlzU3BlZWRDb250cm9sVmlzaWJsZT17aXNTcGVlZENvbnRyb2xWaXNpYmxlfVxuICAgICAgICAgICAgc3BlZWQ9e3NwZWVkfVxuICAgICAgICAgIC8+XG4gICAgICAgICkpfVxuICAgICAgPC9TdHlsZWRBbmltYXRpb25Db250cm9scz5cbiAgICApO1xuICB9O1xuXG4gIFBsYXliYWNrQ29udHJvbHMuZGVmYXVsdFByb3BzID0ge1xuICAgIHBsYXliYWNrSWNvbnM6IERFRkFVTFRfSUNPTlMsXG4gICAgYW5pbWF0aW9uSXRlbXM6IERFRkFVTFRfQU5JTUFURV9JVEVNUyxcbiAgICBidXR0b25TdHlsZTogJ3NlY29uZGFyeScsXG4gICAgYnV0dG9uSGVpZ2h0OiBERUZBVUxUX0JVVFRPTl9IRUlHSFQsXG4gICAgcGxheWJhY2tBY3Rpb25JdGVtczogUExBWUJBQ0tfQ09OVFJPTFNfREVGQVVMVF9BQ1RJT05fQ09NUE9ORU5UUyxcbiAgICBhbmltYXRpb25XaW5kb3c6IEFOSU1BVElPTl9XSU5ET1cuZnJlZSxcbiAgICBpc0FuaW1hdGFibGU6IHRydWUsXG4gICAgcGF1c2VBbmltYXRpb246IG5vcCxcbiAgICByZXNldEFuaW1hdGlvbjogbm9wLFxuICAgIHN0YXJ0QW5pbWF0aW9uOiBub3BcbiAgfTtcblxuICByZXR1cm4gUGxheWJhY2tDb250cm9scztcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWJhY2tDb250cm9sc0ZhY3Rvcnk7XG4iXX0=